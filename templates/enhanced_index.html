<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åª’ä½“åº“æ–‡ä»¶ç®¡ç†å™¨</title>
    <!-- Favicon - SVGæ ¼å¼ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23667eea'/%3E%3Cstop offset='100%25' style='stop-color:%23764ba2'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='32' height='32' rx='6' fill='url(%23bg)'/%3E%3Cpath d='M 6 10 L 6 22 Q 6 23 7 23 L 25 23 Q 26 23 26 22 L 26 10 Z' fill='%23ffd700' opacity='0.9'/%3E%3Cpath d='M 6 10 L 10 8 L 16 8 L 18 10 Z' fill='%23ffd700'/%3E%3Crect x='10' y='13' width='12' height='6' rx='1' fill='%23ffffff' opacity='0.9'/%3E%3Crect x='11' y='14' width='2' height='1' fill='%23667eea' opacity='0.5'/%3E%3Crect x='14' y='14' width='2' height='1' fill='%23764ba2' opacity='0.5'/%3E%3Crect x='17' y='14' width='2' height='1' fill='%23667eea' opacity='0.5'/%3E%3Ccircle cx='24' cy='10' r='3' fill='%23ffd700'/%3E%3Cpath d='M 24 8 L 24.5 9.5 L 26 10 L 24.5 10.5 L 24 12 L 23.5 10.5 L 22 10 L 23.5 9.5 Z' fill='%23ffffff'/%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .scan-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #folderPath {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        #folderPath:focus {
            outline: none;
            border-color: #667eea;
        }

        #folderPath::placeholder {
            color: #999;
        }

        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }

        button:hover {
            background: #5568d3;
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status.info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status.success {
            background: #e8f5e9;
            color: #388e3c;
        }

        .status.error {
            background: #ffebee;
            color: #d32f2f;
        }

        .filter-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            background: #f5f5f5;
            color: #666;
            font-size: 13px;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .file-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .file-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .file-item.subtitle {
            border-left-color: #ff9800;
        }

        .file-icon {
            font-size: 32px;
            margin-right: 16px;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
            word-break: break-all;
        }

        .file-meta {
            font-size: 12px;
            color: #999;
        }

        .rename-btn {
            padding: 8px 16px;
            background: #4caf50;
            font-size: 13px;
        }

        .rename-btn:hover {
            background: #45a049;
        }

        .no-files {
            text-align: center;
            color: #999;
            padding: 40px;
        }

        .file-item.unsupported {
            border-left-color: #f44336;
            opacity: 0.7;
        }

        .delete-btn {
            padding: 8px 16px;
            background: #f44336;
            font-size: 13px;
            margin-left: 8px;
        }

        .delete-btn:hover {
            background: #d32f2f;
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            color: #856404;
        }

        .folder-browser-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .folder-browser-overlay.show {
            display: flex;
        }

        .folder-browser {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .folder-browser-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-browser-header h3 {
            margin: 0;
            color: #333;
        }

        .folder-browser-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .folder-browser-close:hover {
            color: #333;
        }

        .folder-browser-path {
            padding: 15px 20px;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            font-family: monospace;
            font-size: 13px;
            color: #666;
            word-break: break-all;
        }

        .folder-browser-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .folder-item {
            padding: 12px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .folder-item:hover {
            background: #f0f4ff;
        }

        .folder-item-icon {
            font-size: 20px;
        }

        .folder-item-name {
            flex: 1;
            color: #333;
        }

        .folder-browser-footer {
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .folder-browser-footer button {
            padding: 10px 20px;
        }
        
        /* è¿›åº¦å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 2px solid #f0f0f0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: white;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 50%;
            transition: background 0.2s;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .progress-section {
            margin-bottom: 25px;
        }
        
        .progress-section h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .progress-text {
            text-align: center;
            color: #666;
            font-size: 14px;
        }
        
        .current-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .step-icon {
            font-size: 24px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .step-info {
            flex: 1;
        }
        
        .step-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .step-detail {
            color: #666;
            font-size: 14px;
        }
        
        .detail-progress {
            display: grid;
            gap: 8px;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .progress-item.active {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 3px solid #667eea;
        }
        
        .progress-item.completed {
            background: linear-gradient(135deg, #28a74515 0%, #20c99715 100%);
            border-left: 3px solid #28a745;
        }
        
        .progress-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .progress-label {
            flex: 1;
            font-weight: 500;
            color: #333;
        }
        
        .progress-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .progress-status.waiting {
            background: #f8f9fa;
            color: #6c757d;
        }
        
        .progress-status.active {
            background: #667eea;
            color: white;
            animation: blink 1.5s infinite;
        }
        
        .progress-status.completed {
            background: #28a745;
            color: white;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .realtime-log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            line-height: 1.4;
        }
        
        .log-message {
            margin-bottom: 5px;
        }
        
        .log-message:last-child {
            margin-bottom: 0;
        }
        
        /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
        button:hover {
            transform: translateY(-2px);
        }
        
        /* è®¾ç½®å¼¹çª—æ ·å¼ */
        .settings-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .settings-section h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group:last-child {
            margin-bottom: 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-group input[type="text"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        .form-group input[type="text"]:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 12px;
        }
        
        .form-group small a {
            color: #667eea;
            text-decoration: none;
        }
        
        .form-group small a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="display: flex; align-items: center; justify-content: center; gap: 15px;">
            <img src="/logo.svg" alt="Logo" style="width: 50px; height: 50px;">
            <span>åª’ä½“åº“æ–‡ä»¶ç®¡ç†å™¨ <span id="headerVersion">V1.0.1</span></span>
        </h1>
        
        <!-- æ¨¡å—åˆ‡æ¢é€‰é¡¹å¡ -->
        <div style="margin-bottom: 30px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <button id="localModuleTab" onclick="switchModule('local')" style="flex: 1; min-width: 200px; max-width: 250px; padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s;">
                ğŸ’» æœ¬åœ°æ•´ç†
            </button>
            <button id="cloudModuleTab" onclick="switchModule('cloud')" style="flex: 1; min-width: 200px; max-width: 250px; padding: 15px 30px; background: #e9ecef; color: #6c757d; border: 2px solid #dee2e6; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s;">
                â˜ï¸ 115ç½‘ç›˜æ•´ç†
            </button>
            <button id="settingsModuleTab" onclick="switchModule('settings')" style="flex: 1; min-width: 200px; max-width: 250px; padding: 15px 30px; background: #e9ecef; color: #6c757d; border: 2px solid #dee2e6; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s;">
                âš™ï¸ ç³»ç»Ÿè®¾ç½®
            </button>
        </div>
        
        <!-- æœ¬åœ°æ•´ç†æ¨¡å— -->
        <div id="localModule" style="display: block;">
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                ğŸ“‚ æ‰«æè·¯å¾„ï¼š
            </label>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="folderPath" placeholder="è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ï¼Œä¾‹å¦‚ï¼š/vol02/1000-1-b23abde7/å¾…æ•´ç†" 
                       style="flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                <button onclick="openFolderBrowser('scan')" style="padding: 12px 20px; background: #667eea;">
                    ğŸ“ æµè§ˆ
                </button>
            </div>
        </div>

        <!-- æ–°é…ç½®æ–¹å¼ï¼šåª’ä½“åº“è·¯å¾„ -->
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                ğŸ“š åª’ä½“åº“è·¯å¾„ï¼š
            </label>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="mediaLibraryPath" placeholder="è¾“å…¥åª’ä½“åº“æ ¹è·¯å¾„ï¼Œä¾‹å¦‚ï¼š/vol02/1000-1-b23abde7/115" 
                       style="flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                <button onclick="openFolderBrowser('media')" style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                    ğŸ“ æµè§ˆ
                </button>
                <button onclick="detectMediaLibraryStructure()" style="padding: 12px 20px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                    ğŸ” æ£€æµ‹
                </button>
            </div>
            <div id="mediaLibraryInfo" style="margin-top: 10px; padding: 10px; background: #e7f3ff; border-radius: 6px; display: none;">
                <div style="font-size: 13px; color: #0066cc;">
                    <div id="detectedStructure"></div>
                </div>
            </div>
        </div>

        <!-- è¯­è¨€åå¥½ -->
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                ğŸŒ ç›®å½•å‘½åè¯­è¨€ï¼š
            </label>
            <select id="preferredLanguage" style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                <option value="zh">ä¸­æ–‡ï¼ˆç”µå½±ã€ç”µè§†å‰§ï¼‰</option>
                <option value="en">English (Movies, TV Shows)</option>
            </select>
            <div style="margin-top: 8px; font-size: 12px; color: #666;">
                ğŸ’¡ æç¤ºï¼šå¦‚æœåª’ä½“åº“ä¸­å·²æœ‰ç›®å½•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ç°æœ‰ç›®å½•åç§°
            </div>
        </div>

        <!-- æ—§é…ç½®æ–¹å¼ï¼ˆå‘åå…¼å®¹ï¼Œé»˜è®¤éšè—ï¼‰ -->
        <div id="legacyConfig" style="display: none;">
            <div style="margin-bottom: 15px; padding: 12px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffc107;">
                <strong style="color: #856404;">âš ï¸ æ—§é…ç½®æ¨¡å¼</strong><br>
                <span style="font-size: 13px; color: #856404;">å»ºè®®è¿ç§»åˆ°æ–°çš„åª’ä½“åº“è·¯å¾„é…ç½®æ–¹å¼</span>
                <button onclick="showNewConfig()" style="margin-left: 10px; padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                    è¿ç§»åˆ°æ–°é…ç½®
                </button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                    ğŸ¬ ç”µå½±è¾“å‡ºè·¯å¾„ï¼š
                </label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="movieOutputPath" placeholder="è¾“å…¥ç”µå½±è¾“å‡ºè·¯å¾„ï¼Œä¾‹å¦‚ï¼š/vol02/1000-1-b23abde7/ç”µå½±" 
                           style="flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    <button onclick="openFolderBrowser('movie')" style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        ğŸ“ æµè§ˆ
                    </button>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                    ğŸ“º ç”µè§†å‰§è¾“å‡ºè·¯å¾„ï¼š
                </label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="tvOutputPath" placeholder="è¾“å…¥ç”µè§†å‰§è¾“å‡ºè·¯å¾„ï¼Œä¾‹å¦‚ï¼š/vol02/1000-1-b23abde7/ç”µè§†å‰§" 
                           style="flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    <button onclick="openFolderBrowser('tv')" style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        ğŸ“ æµè§ˆ
                    </button>
                </div>
            </div>
        </div>

        <div style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 2px solid #e9ecef;">
            <div style="display: flex; align-items: center; margin-bottom: 12px;">
                <span style="font-size: 20px; margin-right: 8px;">âš™ï¸</span>
                <label style="font-weight: 600; color: #333; font-size: 16px;">
                    æ–‡ä»¶å†²çªå¤„ç†ç­–ç•¥
                </label>
            </div>
            
            <select id="conflictStrategy" style="width: 100%; padding: 12px 16px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 15px; background: white; cursor: pointer; transition: border-color 0.3s;">
                <option value="auto">ğŸ¤– è‡ªåŠ¨æ¯”è¾ƒï¼ˆæ¨èï¼‰- æ™ºèƒ½è¯„åˆ†ï¼Œä¿ç•™æœ€ä½³è´¨é‡</option>
                <option value="skip">â­ï¸ è·³è¿‡ - ä¿ç•™æ—§æ–‡ä»¶ï¼Œä¸å¤„ç†æ–°æ–‡ä»¶</option>
                <option value="replace">ğŸ”„ æ›¿æ¢ - ç›´æ¥ç”¨æ–°æ–‡ä»¶æ›¿æ¢æ—§æ–‡ä»¶</option>
                <option value="keep_both">ğŸ“¦ ä¿ç•™ä¸¤ä¸ª - æ–°æ–‡ä»¶æ·»åŠ ç‰ˆæœ¬å·åç¼€</option>
            </select>
            
            <div style="margin-top: 12px; padding: 12px; background: white; border-radius: 6px; border-left: 4px solid #667eea;">
                <div style="font-weight: 600; color: #667eea; margin-bottom: 8px;">ğŸ“Š ç­–ç•¥è¯´æ˜ï¼š</div>
                <div style="font-size: 13px; color: #495057; line-height: 1.8;">
                    <strong>ğŸ¤– è‡ªåŠ¨æ¯”è¾ƒ</strong>ï¼šç»¼åˆè¯„åˆ†ç³»ç»Ÿ<br>
                    <span style="margin-left: 20px;">â€¢ åˆ†è¾¨ç‡ï¼š4K(2160åˆ†) > 1080p(1080åˆ†) > 720p(720åˆ†)</span><br>
                    <span style="margin-left: 20px;">â€¢ æ¥æºï¼šREMUX(100åˆ†) > BluRay(80åˆ†) > WEB-DL(60åˆ†) > WEBRip(40åˆ†)</span><br>
                    <span style="margin-left: 20px;">â€¢ ç¼–ç ï¼šH.265/HEVC(+10åˆ†) > H.264(0åˆ†)</span><br>
                    <span style="margin-left: 20px;">â€¢ å¤§å°ï¼šè¯„åˆ†ç›¸åŒæ—¶ï¼Œæ–‡ä»¶è¶Šå¤§è¶Šå¥½ï¼ˆå·®å¼‚<1MBè§†ä¸ºç›¸åŒï¼‰</span><br>
                    <span style="margin-left: 20px; color: #28a745;">âœ“ é€‚åˆï¼šæ—¥å¸¸ä½¿ç”¨ï¼Œè‡ªåŠ¨ä¿ç•™æœ€ä½³ç‰ˆæœ¬</span><br><br>
                    
                    <strong>â­ï¸ è·³è¿‡</strong>ï¼šä¿å®ˆç­–ç•¥<br>
                    <span style="margin-left: 20px;">â€¢ ä¿ç•™ç›®æ ‡ç›®å½•ä¸­çš„æ—§æ–‡ä»¶</span><br>
                    <span style="margin-left: 20px;">â€¢ ä¸å¤„ç†å¾…æ•´ç†ç›®å½•ä¸­çš„æ–°æ–‡ä»¶</span><br>
                    <span style="margin-left: 20px; color: #28a745;">âœ“ é€‚åˆï¼šå¢é‡æ›´æ–°ï¼Œåªæ·»åŠ æ–°é›†æ•°</span><br><br>
                    
                    <strong>ğŸ”„ æ›¿æ¢</strong>ï¼šæ¿€è¿›ç­–ç•¥<br>
                    <span style="margin-left: 20px;">â€¢ ç›´æ¥ç”¨æ–°æ–‡ä»¶æ›¿æ¢æ—§æ–‡ä»¶</span><br>
                    <span style="margin-left: 20px;">â€¢ ä¸è¿›è¡Œè´¨é‡æ¯”è¾ƒ</span><br>
                    <span style="margin-left: 20px; color: #28a745;">âœ“ é€‚åˆï¼šé‡æ–°ä¸‹è½½æ›´å¥½çš„ç‰ˆæœ¬</span><br><br>
                    
                    <strong>ğŸ“¦ ä¿ç•™ä¸¤ä¸ª</strong>ï¼šæ”¶è—ç­–ç•¥<br>
                    <span style="margin-left: 20px;">â€¢ ä¿ç•™æ—§æ–‡ä»¶</span><br>
                    <span style="margin-left: 20px;">â€¢ æ–°æ–‡ä»¶æ·»åŠ ç‰ˆæœ¬å·ï¼ˆ.v1, .v2...ï¼‰</span><br>
                    <span style="margin-left: 20px; color: #28a745;">âœ“ é€‚åˆï¼šå¤šç‰ˆæœ¬å¯¹æ¯”ï¼Œä¸åŒå­—å¹•ç»„</span>
                </div>
            </div>
        </div>

        <!-- è·¯å¾„é¢„è§ˆåŒºåŸŸ -->
        <div id="pathPreviewSection" style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #e7f3ff 0%, #f0e7ff 100%); border-radius: 8px; border: 2px solid #667eea; display: none;">
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <span style="font-size: 18px; margin-right: 8px;">ğŸ“‹</span>
                <strong style="color: #667eea; font-size: 15px;">è·¯å¾„é…ç½®é¢„è§ˆ</strong>
            </div>
            <div id="pathPreviewContent" style="font-size: 13px; color: #333; line-height: 1.8;">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
        </div>

        <div style="text-align: center; margin-bottom: 20px; display: flex; gap: 15px; justify-content: center; align-items: center;">
            <button onclick="previewPaths()" style="font-size: 16px; padding: 14px 36px; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4); border: none; border-radius: 8px; color: white; cursor: pointer; transition: transform 0.2s; font-weight: 500;">
                ğŸ‘ï¸ é¢„è§ˆè·¯å¾„
            </button>
            <button onclick="startAutoRename()" style="font-size: 16px; padding: 14px 36px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); border: none; border-radius: 8px; color: white; cursor: pointer; transition: transform 0.2s; font-weight: 500;">
                ğŸš€ ä¸€é”®æ•´ç†å…¥åº“
            </button>
            <button onclick="showProgressModal()" style="font-size: 16px; padding: 14px 36px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4); border: none; border-radius: 8px; color: white; cursor: pointer; transition: transform 0.2s; font-weight: 500;">
                ğŸ“Š æ•´ç†è¯¦æƒ…
            </button>
        </div>

        <!-- åŠŸèƒ½è¯´æ˜ï¼ˆå¯æŠ˜å ï¼‰ -->
        <div style="margin-bottom: 20px;">
            <div onclick="toggleFunctionInfo()" style="cursor: pointer; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);">
                <div style="display: flex; align-items: center;">
                    <span style="font-size: 20px; margin-right: 10px; color: white;">ğŸ“–</span>
                    <strong style="font-size: 16px; color: white;">åŠŸèƒ½è¯´æ˜ - å®Œæ•´å¤„ç†æµç¨‹</strong>
                </div>
                <span id="functionInfoToggle" style="color: white; font-size: 20px;">â–¼</span>
            </div>
            
            <div id="functionInfoContent" class="info-box" style="display: none; margin-top: 10px; padding: 20px; border: 2px solid #667eea; border-radius: 8px;">
                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong style="color: #667eea;">ğŸ“‚ æ­¥éª¤1ï¼šæ™ºèƒ½æ‰«æ</strong><br>
                    â€¢ é€’å½’æ‰«æå¾…æ•´ç†ç›®å½•çš„æ‰€æœ‰å­æ–‡ä»¶å¤¹<br>
                    â€¢ è‡ªåŠ¨è¯†åˆ«åª’ä½“æ–‡ä»¶ï¼ˆè§†é¢‘ï¼‰å’Œå­—å¹•æ–‡ä»¶<br>
                    â€¢ è‡ªåŠ¨åˆ é™¤ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚txtã€jpgç­‰ï¼‰<br>
                    â€¢ æ”¯æŒæ ¼å¼ï¼šmp4, mkv, ts, iso, rmvb, avi, mov, mpeg, mpg, wmv, 3gp, asf, m4v, flv, m2ts, tp, f4v, srt, ssa, ass
                </div>

                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong style="color: #667eea;">ğŸŒ æ­¥éª¤2ï¼šä¸­æ–‡æ ‡é¢˜è¯†åˆ«</strong><br>
                    â€¢ <strong>è±†ç“£ä¼˜å…ˆ</strong>ï¼šå®Œæ•´æ ‡é¢˜æŸ¥è¯¢ â†’ æ¸…ç†æ ‡é¢˜ â†’ æ¸è¿›ç¼©çŸ­ â†’ å…³é”®è¯æŸ¥è¯¢<br>
                    â€¢ <strong>TMDBå¤‡ç”¨</strong>ï¼šå®Œæ•´æ ‡é¢˜æŸ¥è¯¢ â†’ ä¸å¸¦å¹´ä»½ â†’ æ¸è¿›ç¼©çŸ­<br>
                    â€¢ <strong>æ™ºèƒ½ç¼“å­˜</strong>ï¼šç›¸åŒæ ‡é¢˜ä¸é‡å¤æŸ¥è¯¢ï¼Œæé«˜æ•ˆç‡<br>
                    â€¢ <strong>æ”¯æŒè¶…é•¿æ ‡é¢˜</strong>ï¼šå¦‚ "Apocalypse Bringer Mynoghra World Conquest..." â†’ "å¼‚ä¸–ç•Œé»˜ç¤ºå½•éº¦è¯ºæ ¼æ‹‰"<br>
                    â€¢ <strong>è·å–å…ƒæ•°æ®</strong>ï¼šåŒæ—¶è·å–genre_idsã€origin_countryã€original_languageç”¨äºåç»­åˆ†ç±»
                </div>

                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong style="color: #667eea;">ğŸ¯ æ­¥éª¤3ï¼šæ™ºèƒ½å»é‡</strong><br>
                    â€¢ <strong>è¯†åˆ«é‡å¤</strong>ï¼šç›¸åŒæ ‡é¢˜+å¹´ä»½+å­£é›† = åŒä¸€å½±ç‰‡<br>
                    â€¢ <strong>è´¨é‡è¯„åˆ†</strong>ï¼šåˆ†è¾¨ç‡(4K=2160åˆ†) + æ¥æº(REMUX=100åˆ†) + ç¼–ç (H.265=+10åˆ†) + æ–‡ä»¶å¤§å°<br>
                    â€¢ <strong>è‡ªåŠ¨ä¿ç•™</strong>ï¼šä¿ç•™è¯„åˆ†æœ€é«˜çš„ç‰ˆæœ¬<br>
                    â€¢ <strong>è‡ªåŠ¨åˆ é™¤</strong>ï¼šåˆ é™¤ä½è´¨é‡ç‰ˆæœ¬ï¼Œé‡Šæ”¾ç©ºé—´<br>
                    â€¢ <strong>å‡å°‘å¤„ç†é‡</strong>ï¼šå»é‡ååªå¤„ç†ä¿ç•™çš„æ–‡ä»¶ï¼Œæé«˜æ•ˆç‡
                </div>

                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong style="color: #667eea;">ğŸ“ æ­¥éª¤4ï¼šæ ‡å‡†åŒ–é‡å‘½å</strong><br>
                    â€¢ <strong>ç”µå½±æ ¼å¼</strong>ï¼šæ ‡é¢˜ (å¹´ä»½)/æ ‡é¢˜ (å¹´ä»½) - åˆ†è¾¨ç‡.è¯­è¨€.æ‰©å±•å<br>
                      <small style="color: #666;">ç¤ºä¾‹ï¼šé“ƒèŠ½ä¹‹æ—… (2022)/é“ƒèŠ½ä¹‹æ—… (2022) - 1080p.chs.mkv</small><br>
                    â€¢ <strong>ç”µè§†å‰§æ ¼å¼</strong>ï¼šæ ‡é¢˜ (å¹´ä»½)/Season X/æ ‡é¢˜ - S0XE0X - ç¬¬ X é›†.è¯­è¨€.æ‰©å±•å<br>
                      <small style="color: #666;">ç¤ºä¾‹ï¼šå¼‚ä¸–ç•Œé»˜ç¤ºå½•éº¦è¯ºæ ¼æ‹‰ (2025)/Season 1/å¼‚ä¸–ç•Œé»˜ç¤ºå½•éº¦è¯ºæ ¼æ‹‰ - S01E01 - ç¬¬ 01 é›†.mkv</small><br>
                    â€¢ <strong>ç¬¦åˆè§„èŒƒ</strong>ï¼šå®Œç¾å…¼å®¹Embyã€Jellyfinã€Plexç­‰åª’ä½“æœåŠ¡å™¨<br>
                    â€¢ <strong>ç”Ÿæˆè·¯å¾„</strong>ï¼šæ ¹æ®æ¨¡æ¿ç”Ÿæˆæ ‡å‡†åŒ–çš„æ–‡ä»¶åå’Œç›®å½•ç»“æ„
                </div>

                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong style="color: #667eea;">ğŸ“ æ­¥éª¤5ï¼šæ™ºèƒ½åˆ†ç±»</strong><br>
                    â€¢ <strong>åŸºäºTMDBå…ƒæ•°æ®</strong>ï¼šgenre_idsï¼ˆç±»å‹ï¼‰+ origin_countryï¼ˆå›½å®¶ï¼‰+ original_languageï¼ˆè¯­è¨€ï¼‰<br>
                    â€¢ <strong>ç”µå½±åˆ†ç±»</strong>ï¼šåŠ¨ç”»ç”µå½±ã€åè¯­ç”µå½±ã€å¤–è¯­ç”µå½±<br>
                    â€¢ <strong>ç”µè§†å‰§åˆ†ç±»</strong>ï¼šå›½æ¼«ã€æ—¥ç•ªã€çºªå½•ç‰‡ã€å„¿ç«¥ã€ç»¼è‰ºã€å›½äº§å‰§ã€æ¬§ç¾å‰§ã€æ—¥éŸ©å‰§ã€æœªåˆ†ç±»<br>
                    â€¢ <strong>ç¡®å®šç›®æ ‡</strong>ï¼šæ ¹æ®åˆ†ç±»ç¡®å®šæœ€ç»ˆçš„è¾“å‡ºç›®å½•è·¯å¾„
                </div>

                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong style="color: #667eea;">ğŸšš æ­¥éª¤6ï¼šè‡ªåŠ¨ç§»åŠ¨</strong><br>
                    â€¢ <strong>ç”µå½±</strong>ï¼šç§»åŠ¨åˆ° ç”µå½±è¾“å‡ºè·¯å¾„/åˆ†ç±»ç›®å½•/æ ‡é¢˜æ–‡ä»¶å¤¹/<br>
                    â€¢ <strong>ç”µè§†å‰§</strong>ï¼šç§»åŠ¨åˆ° ç”µè§†å‰§è¾“å‡ºè·¯å¾„/åˆ†ç±»ç›®å½•/æ ‡é¢˜æ–‡ä»¶å¤¹/Season X/<br>
                    â€¢ <strong>è‡ªåŠ¨åˆ›å»º</strong>ï¼šç›®æ ‡ç›®å½•ç»“æ„è‡ªåŠ¨åˆ›å»º<br>
                    â€¢ <strong>ç½‘ç›˜ä¼˜åŒ–</strong>ï¼šæ“ä½œé—´éš”å’Œå»¶è¿ŸéªŒè¯ï¼Œç¡®ä¿ç½‘ç›˜åŒæ­¥æˆåŠŸ<br>
                    â€¢ <strong>è§¦å‘å†²çªæ£€æµ‹</strong>ï¼šç§»åŠ¨æ—¶æ£€æŸ¥ç›®æ ‡ä½ç½®æ˜¯å¦å·²æœ‰åŒåæ–‡ä»¶
                </div>

                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong style="color: #667eea;">âš”ï¸ æ­¥éª¤7ï¼šå†²çªå¤„ç†</strong><br>
                    â€¢ <strong>è‡ªåŠ¨æ¯”è¾ƒ</strong>ï¼šæ™ºèƒ½è¯„åˆ†ï¼Œä¿ç•™æœ€ä½³è´¨é‡ï¼ˆè¯„åˆ†ç›¸åŒä¸”å¤§å°å·®å¼‚<1MBè§†ä¸ºç›¸åŒæ–‡ä»¶ï¼‰<br>
                    â€¢ <strong>è·³è¿‡</strong>ï¼šä¿ç•™æ—§æ–‡ä»¶ï¼Œä¸å¤„ç†æ–°æ–‡ä»¶ï¼ˆé€‚åˆå¢é‡æ›´æ–°ï¼‰<br>
                    â€¢ <strong>æ›¿æ¢</strong>ï¼šç›´æ¥ç”¨æ–°æ–‡ä»¶æ›¿æ¢æ—§æ–‡ä»¶ï¼ˆé€‚åˆé‡æ–°ä¸‹è½½ï¼‰<br>
                    â€¢ <strong>ä¿ç•™ä¸¤ä¸ª</strong>ï¼šæ–°æ–‡ä»¶æ·»åŠ ç‰ˆæœ¬å·.v1ï¼ˆé€‚åˆå¤šç‰ˆæœ¬å¯¹æ¯”ï¼‰<br>
                    â€¢ <strong>å®æ—¶å†³ç­–</strong>ï¼šåœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­é‡åˆ°å†²çªæ—¶ç«‹å³å¤„ç†
                </div>

                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 15px; border-radius: 8px;">
                    <strong style="color: #667eea;">ğŸ§¹ æ­¥éª¤8ï¼šè‡ªåŠ¨æ¸…ç†</strong><br>
                    â€¢ <strong>æ¸…ç†è·³è¿‡çš„æ–‡ä»¶</strong>ï¼šåˆ é™¤å› è´¨é‡ç›¸åŒæˆ–è¾ƒå·®è€Œè·³è¿‡çš„æ–‡ä»¶<br>
                    â€¢ <strong>æ¸…ç†ç©ºæ–‡ä»¶å¤¹</strong>ï¼šé€’å½’åˆ é™¤æ‰€æœ‰ç©ºæ–‡ä»¶å¤¹ï¼ˆä»åº•å±‚å‘ä¸Šï¼‰<br>
                    â€¢ <strong>é‡Šæ”¾ç©ºé—´</strong>ï¼šæœ€å¤§åŒ–é‡Šæ”¾ç£ç›˜ç©ºé—´<br>
                    â€¢ <strong>ä¿æŒæ•´æ´</strong>ï¼šå¾…æ•´ç†ç›®å½•å¤„ç†å®Œæˆåè‡ªåŠ¨æ¸…ç©º
                </div>

                <div style="margin-top: 15px; padding: 12px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
                    <strong style="color: #856404;">ğŸ’¡ ä½¿ç”¨æç¤º</strong><br>
                    <small style="color: #856404;">
                    â€¢ <strong>é¦–æ¬¡ä½¿ç”¨</strong>ï¼šç‚¹å‡»"è®¾ç½®"é…ç½®APIå¯†é’¥ â†’ é…ç½®ä¸‰ä¸ªè·¯å¾„ â†’ é€‰æ‹©"è‡ªåŠ¨æ¯”è¾ƒ"ç­–ç•¥ â†’ ç‚¹å‡»"ä¸€é”®æ•´ç†å…¥åº“"<br>
                    â€¢ <strong>æ—¥å¸¸ä½¿ç”¨</strong>ï¼šæ–°æ–‡ä»¶æ”¾å…¥å¾…æ•´ç†ç›®å½• â†’ ç‚¹å‡»æŒ‰é’® â†’ è‡ªåŠ¨å®Œæˆæ‰€æœ‰æ“ä½œ<br>
                    â€¢ <strong>å¢é‡æ›´æ–°</strong>ï¼šä½¿ç”¨"è·³è¿‡"ç­–ç•¥ï¼Œåªå¤„ç†æ–°å¢æ–‡ä»¶ï¼Œä¸å½±å“å·²æ•´ç†çš„åº“<br>
                    â€¢ <strong>ç½‘ç›˜ç”¨æˆ·</strong>ï¼šå¤„ç†è¿‡ç¨‹è¾ƒæ…¢å±æ­£å¸¸ç°è±¡ï¼Œç³»ç»Ÿå·²é’ˆå¯¹ç½‘ç›˜ä¼˜åŒ–<br>
                    â€¢ <strong>åˆ†äº«ç»™æœ‹å‹</strong>ï¼šæ¯ä¸ªç”¨æˆ·éœ€è¦åœ¨"è®¾ç½®"ä¸­é…ç½®è‡ªå·±çš„TMDB API Keyå’Œè±†ç“£Cookie
                    </small>
                </div>
            </div>
        </div>
        </div>
        <!-- æœ¬åœ°æ•´ç†æ¨¡å—ç»“æŸ -->
        
        <!-- 115ç½‘ç›˜æ•´ç†æ¨¡å— -->
        <div id="cloudModule" style="display: none;">
            <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-radius: 12px; border: 2px solid #667eea;">
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <span style="font-size: 24px; margin-right: 10px;">â˜ï¸</span>
                    <h3 style="margin: 0; color: #667eea;">115ç½‘ç›˜äº‘ç«¯æ•´ç†</h3>
                </div>
                <p style="margin: 0; color: #666; line-height: 1.6;">
                    çº¯äº‘ç«¯æ“ä½œï¼Œæ— éœ€ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°ã€‚é€šè¿‡115 APIç›´æ¥åœ¨äº‘ç«¯å®Œæˆæ‰«æã€è¯†åˆ«ã€é‡å‘½åå’Œåˆ†ç±»æ•´ç†ã€‚
                </p>
            </div>
            
            <!-- 115ç½‘ç›˜Cookieé…ç½® -->
            <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border: 2px solid #e0e0e0;">
                <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                    <span>ğŸ”</span>
                    <span>115ç½‘ç›˜ç™»å½•é…ç½®</span>
                </h4>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333; display: flex; align-items: center; gap: 8px;">
                        <span>115 Cookie</span>
                        <span id="cloud115StatusIndicator" style="width: 10px; height: 10px; border-radius: 50%; background: #ccc;" title="CookieçŠ¶æ€"></span>
                        <span id="cloud115StatusText" style="font-size: 12px; font-weight: normal; color: #666;"></span>
                    </label>
                    <div style="position: relative; display: flex; gap: 8px; align-items: center;">
                        <input type="password" id="cloud115CookieInline" placeholder="ç²˜è´´115ç½‘ç›˜Cookieï¼Œå°†è‡ªåŠ¨éªŒè¯..." 
                               style="flex: 1; padding: 12px 120px 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: monospace;"
                               oninput="autoVerifyCloud115Cookie()">
                        <div style="position: absolute; right: 60px; display: flex; gap: 8px; align-items: center;">
                            <button onclick="toggleCookieVisibility()" title="æ˜¾ç¤º/éšè—Cookie" 
                                    style="padding: 8px; background: transparent; border: none; cursor: pointer; font-size: 18px;">
                                ğŸ‘ï¸
                            </button>
                            <button onclick="copyCookie()" title="å¤åˆ¶Cookie" 
                                    style="padding: 8px; background: transparent; border: none; cursor: pointer; font-size: 18px;">
                                ğŸ“‹
                            </button>
                        </div>
                        <button onclick="showQRCodeLogin()" title="æ‰«ç ç™»å½•" 
                                style="padding: 12px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 20px; white-space: nowrap;">
                            ğŸ“±
                        </button>
                    </div>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        ç‚¹å‡»å›¾æ ‡åˆ‡æ¢æ˜¾ç¤ºã€å¤åˆ¶æˆ–æ‰«ç ç™»å½• | æ‰‹åŠ¨è·å–: ç™»å½•115ç½‘ç›˜ â†’ F12 â†’ Application â†’ Cookies
                    </small>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                    â˜ï¸ 115ç½‘ç›˜æ–‡ä»¶å¤¹ï¼š
                </label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="cloud115FolderPath" placeholder="é€‰æ‹©è¦æ•´ç†çš„115ç½‘ç›˜æ–‡ä»¶å¤¹" readonly
                           style="flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: #f8f9fa; cursor: pointer;"
                           onclick="openCloud115Browser()">
                    <button onclick="openCloud115Browser()" style="padding: 12px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        ğŸ“ æµè§ˆç½‘ç›˜
                    </button>
                </div>
                <small style="color: #666; margin-top: 5px; display: block;">ç‚¹å‡»æµè§ˆæŒ‰é’®é€‰æ‹©115ç½‘ç›˜ä¸­è¦æ•´ç†çš„æ–‡ä»¶å¤¹</small>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px; display: flex; gap: 15px; justify-content: center;">
                <button onclick="startCloud115Organize()" style="font-size: 16px; padding: 14px 36px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); border: none; border-radius: 8px; color: white; cursor: pointer; transition: transform 0.2s; font-weight: 500;">
                    ğŸš€ å¼€å§‹äº‘ç«¯æ•´ç†
                </button>
                <button onclick="showCloudHistory()" style="font-size: 16px; padding: 14px 36px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4); border: none; border-radius: 8px; color: white; cursor: pointer; transition: transform 0.2s; font-weight: 500;">
                    ğŸ“œ æ“ä½œå†å²
                </button>
            </div>
            
            <div style="margin-bottom: 20px; padding: 20px; background: #fff3cd; border-radius: 12px; border-left: 4px solid #ffc107;">
                <strong style="color: #856404;">ğŸ’¡ 115ç½‘ç›˜æ•´ç†è¯´æ˜</strong><br>
                <small style="color: #856404; line-height: 1.8;">
                â€¢ <strong>é¦–æ¬¡ä½¿ç”¨</strong>ï¼šåœ¨"è®¾ç½®"ä¸­é…ç½®115ç½‘ç›˜Cookie<br>
                â€¢ <strong>çº¯äº‘ç«¯æ“ä½œ</strong>ï¼šæ‰€æœ‰æ“ä½œé€šè¿‡115 APIå®Œæˆï¼Œä¸å ç”¨æœ¬åœ°ç©ºé—´<br>
                â€¢ <strong>æ™ºèƒ½è¯†åˆ«</strong>ï¼šè‡ªåŠ¨è¯†åˆ«åª’ä½“æ–‡ä»¶ï¼Œè·å–ä¸­æ–‡æ ‡é¢˜<br>
                â€¢ <strong>æ ‡å‡†åŒ–å‘½å</strong>ï¼šæŒ‰ç…§Plex/Jellyfin/Embyæ ‡å‡†æ ¼å¼é‡å‘½å<br>
                â€¢ <strong>è‡ªåŠ¨åˆ†ç±»</strong>ï¼šç”µå½±å’Œç”µè§†å‰§è‡ªåŠ¨åˆ†ç±»åˆ°ä¸åŒæ–‡ä»¶å¤¹
                </small>
            </div>
        </div>
        <!-- 115ç½‘ç›˜æ•´ç†æ¨¡å—ç»“æŸ -->

        <!-- ç³»ç»Ÿè®¾ç½®æ¨¡å— -->
        <div id="settingsModule" style="display: none;">
            <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); border-radius: 12px; border: 2px solid #ff9800;">
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <span style="font-size: 24px; margin-right: 10px;">âš™ï¸</span>
                    <h3 style="margin: 0; color: white;">ç³»ç»Ÿè®¾ç½®</h3>
                </div>
                <p style="margin: 0; color: white; line-height: 1.6;">
                    é…ç½®ç³»ç»Ÿå…¨å±€å‚æ•°ï¼ŒåŒ…æ‹¬ TMDB APIã€è±†ç“£ Cookieã€ç³»ç»Ÿæ›´æ–°ç­‰
                </p>
            </div>

            <!-- TMDBè®¾ç½® -->
            <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border: 2px solid #e0e0e0;">
                <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                    <span>ğŸ¬</span>
                    <span>TMDB é…ç½®</span>
                </h4>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">API Key:</label>
                    <input type="text" id="tmdbApiKeySettings" placeholder="è¾“å…¥TMDB API Key" style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        è·å–åœ°å€: <a href="https://www.themoviedb.org/settings/api" target="_blank" style="color: #667eea;">https://www.themoviedb.org/settings/api</a>
                    </small>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        <input type="checkbox" id="tmdbProxyEnabledSettings" style="width: auto; margin-right: 8px;">
                        å¯ç”¨ TMDB ä»£ç†
                    </label>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">ä»£ç†åœ°å€:</label>
                    <input type="text" id="tmdbProxySettings" placeholder="ä¾‹å¦‚: http://127.0.0.1:7890" style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    <small style="color: #666; display: block; margin-top: 5px;">ç”¨äºè®¿é—® TMDB APIï¼ˆå¯é€‰ï¼‰</small>
                </div>
            </div>

            <!-- è±†ç“£è®¾ç½® -->
            <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border: 2px solid #e0e0e0;">
                <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                    <span>ğŸ­</span>
                    <span>è±†ç“£é…ç½®</span>
                </h4>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Cookie:</label>
                    <textarea id="doubanCookieSettings" rows="3" placeholder="è¾“å…¥è±†ç“£Cookie" style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: monospace;"></textarea>
                    <small style="color: #666; display: block; margin-top: 5px;">è·å–æ–¹æ³•: ç™»å½•è±†ç“£ â†’ F12 â†’ Application â†’ Cookies â†’ å¤åˆ¶æ‰€æœ‰Cookie</small>
                </div>
            </div>

            <!-- ç³»ç»Ÿæ›´æ–°è®¾ç½® -->
            <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border: 2px solid #e0e0e0;">
                <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                    <span>ğŸ”„</span>
                    <span>ç³»ç»Ÿæ›´æ–°é…ç½®</span>
                </h4>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">å½“å‰ç‰ˆæœ¬:</label>
                    <div id="currentVersionSettings" style="padding: 12px 16px; background: #f8f9fa; border-radius: 8px; font-weight: 600; color: #667eea;">åŠ è½½ä¸­...</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        <input type="checkbox" id="updateProxyEnabledSettings" style="width: auto; margin-right: 8px;">
                        å¯ç”¨æ›´æ–°ä»£ç†
                    </label>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">æ›´æ–°ä»£ç†åœ°å€:</label>
                    <input type="text" id="updateProxySettings" placeholder="ä¾‹å¦‚: http://127.0.0.1:7890" style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    <small style="color: #666; display: block; margin-top: 5px;">ç”¨äºè®¿é—®GitHubï¼Œç›´è¿å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢ä»£ç†</small>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                        <input type="checkbox" id="autoRestartAfterUpdateSettings" style="width: auto; margin-right: 8px;" checked>
                        æ›´æ–°åè‡ªåŠ¨é‡å¯æœåŠ¡
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="checkForUpdatesInSettings()" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        ğŸ” æ£€æŸ¥æ›´æ–°
                    </button>
                    <button onclick="viewUpdateHistory()" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #6c757d 0%, #495057 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        ğŸ“œ æ›´æ–°å†å²
                    </button>
                </div>
            </div>

            <!-- ä¿å­˜æŒ‰é’® -->
            <div style="text-align: center; margin-bottom: 20px;">
                <button onclick="saveSettingsFromModule()" style="font-size: 16px; padding: 14px 36px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); border: none; border-radius: 8px; color: white; cursor: pointer; transition: transform 0.2s; font-weight: 500;">
                    ğŸ’¾ ä¿å­˜è®¾ç½®
                </button>
            </div>
        </div>
        <!-- ç³»ç»Ÿè®¾ç½®æ¨¡å—ç»“æŸ -->

        <div id="status" class="status"></div>

        <!-- æ•´ç†è¯¦æƒ…å¼¹çª— -->
        <div id="progressModal" class="modal-overlay" style="display: none;">
            <div class="modal-content" style="width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                <div class="modal-header">
                    <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                        <span>ğŸ“Š</span>
                        <span>æ•´ç†è¯¦æƒ…</span>
                    </h2>
                    <button onclick="closeProgressModal()" class="close-btn">Ã—</button>
                </div>
                
                <div class="modal-body">
                    <!-- æ•´ä½“è¿›åº¦ -->
                    <div class="progress-section">
                        <h3>ğŸš€ æ•´ä½“è¿›åº¦</h3>
                        <div class="progress-bar">
                            <div id="overallProgress" class="progress-fill"></div>
                        </div>
                        <div id="overallStatus" class="progress-text">å‡†å¤‡å¼€å§‹...</div>
                    </div>
                    
                    <!-- å½“å‰æ­¥éª¤ -->
                    <div class="progress-section">
                        <h3>âš¡ å½“å‰æ­¥éª¤</h3>
                        <div id="currentStep" class="current-step">
                            <div class="step-icon">ğŸ“‚</div>
                            <div class="step-info">
                                <div class="step-title">ç­‰å¾…å¼€å§‹</div>
                                <div class="step-detail">ç‚¹å‡»"ä¸€é”®æ•´ç†å…¥åº“"å¼€å§‹å¤„ç†</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è¯¦ç»†æ“ä½œæ—¥å¿— -->
                    <div class="progress-section">
                        <h3>ğŸ“‹ è¯¦ç»†æ“ä½œæ—¥å¿—</h3>
                        <div id="detailLog" class="detail-log" style="max-height: 400px; overflow-y: auto; background: #f8f9fa; border-radius: 8px; padding: 15px; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; line-height: 1.8;">
                            <div style="color: #999; text-align: center; padding: 20px;">ç­‰å¾…å¼€å§‹å¤„ç†...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®å¼¹çª— -->
    <div id="settingsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 90%; max-width: 600px; max-height: 85vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                    <span>âš™ï¸</span>
                    <span>ç³»ç»Ÿè®¾ç½®</span>
                </h2>
                <button onclick="closeSettingsModal()" class="close-btn">Ã—</button>
            </div>
            
            <div class="modal-body" style="overflow-y: auto; flex: 1;">
                <!-- TMDBè®¾ç½® -->
                <div class="settings-section">
                    <h3>ğŸ¬ TMDBé…ç½®</h3>
                    <div class="form-group">
                        <label>API Key:</label>
                        <input type="text" id="tmdbApiKey" placeholder="è¾“å…¥TMDB API Key">
                        <small>è·å–åœ°å€: <a href="https://www.themoviedb.org/settings/api" target="_blank">TMDB API</a></small>
                    </div>
                    <div class="form-group">
                        <label>ä»£ç†åœ°å€:</label>
                        <input type="text" id="tmdbProxy" placeholder="ä¾‹å¦‚: http://192.168.1.1:7890">
                        <small>ç•™ç©ºåˆ™ä¸ä½¿ç”¨ä»£ç†</small>
                    </div>
                    <div class="form-group">
                        <label>ä»£ç†ç±»å‹:</label>
                        <select id="tmdbProxyType">
                            <option value="http">HTTP/HTTPS</option>
                            <option value="socks5">SOCKS5</option>
                        </select>
                    </div>
                </div>
                
                <!-- è±†ç“£è®¾ç½® -->
                <div class="settings-section">
                    <h3>ğŸ­ è±†ç“£é…ç½®</h3>
                    <div class="form-group">
                        <label>Cookie:</label>
                        <textarea id="doubanCookie" rows="3" placeholder="è¾“å…¥è±†ç“£Cookie"></textarea>
                        <small>è·å–æ–¹æ³•: ç™»å½•è±†ç“£ â†’ F12å¼€å‘è€…å·¥å…· â†’ Network â†’ å¤åˆ¶Cookie</small>
                    </div>
                </div>
                
                <!-- ç³»ç»Ÿæ›´æ–°è®¾ç½® -->
                <div class="settings-section">
                    <h3>ğŸ”„ ç³»ç»Ÿæ›´æ–°é…ç½®</h3>
                    <div class="form-group">
                        <label>å½“å‰ç‰ˆæœ¬:</label>
                        <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; font-weight: 600; color: #667eea;" id="currentVersion">
                            åŠ è½½ä¸­...
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="updateProxyEnabled" style="width: auto; margin-right: 8px;">
                            å¯ç”¨æ›´æ–°ä»£ç†
                        </label>
                    </div>
                    <div class="form-group">
                        <label>æ›´æ–°ä»£ç†åœ°å€:</label>
                        <input type="text" id="updateProxy" placeholder="ä¾‹å¦‚: http://127.0.0.1:7890">
                        <small>ç”¨äºè®¿é—®GitHubï¼Œç›´è¿å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢ä»£ç†</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="autoRestartAfterUpdate" style="width: auto; margin-right: 8px;" checked>
                            æ›´æ–°åè‡ªåŠ¨é‡å¯æœåŠ¡
                        </label>
                    </div>
                    <div style="margin-top: 15px;">
                        <button onclick="checkForUpdates()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">
                            ğŸ” æ£€æŸ¥æ›´æ–°
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- æŒ‰é’®åŒºåŸŸï¼ˆå›ºå®šåœ¨åº•éƒ¨ï¼‰ -->
            <div style="display: flex; gap: 10px; justify-content: flex-end; padding: 20px 25px; border-top: 2px solid #f0f0f0; background: #fafafa; border-radius: 0 0 12px 12px;">
                <button onclick="closeSettingsModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    å–æ¶ˆ
                </button>
                <button onclick="saveSettings()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer;">
                    ä¿å­˜è®¾ç½®
                </button>
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶å¤¹æµè§ˆå™¨å¼¹çª— -->
    <div id="folderBrowserOverlay" class="folder-browser-overlay" onclick="closeFolderBrowser(event)">
        <div class="folder-browser" onclick="event.stopPropagation()">
            <div class="folder-browser-header">
                <h3>ğŸ“ é€‰æ‹©æ–‡ä»¶å¤¹</h3>
                <button class="folder-browser-close" onclick="closeFolderBrowser()">Ã—</button>
            </div>
            <div class="folder-browser-path" id="currentBrowserPath">/</div>
            <div class="folder-browser-list" id="folderList">
                <div style="text-align: center; padding: 40px; color: #999;">
                    åŠ è½½ä¸­...
                </div>
            </div>
            <div class="folder-browser-footer">
                <button onclick="closeFolderBrowser()" style="background: #999;">å–æ¶ˆ</button>
                <button onclick="selectCurrentFolder()" style="background: #4caf50;">é€‰æ‹©æ­¤æ–‡ä»¶å¤¹</button>
            </div>
        </div>
    </div>

    <!-- é…ç½®è¿ç§»æç¤ºå¯¹è¯æ¡† -->
    <div id="configMigrationOverlay" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 90%; max-width: 600px;">
            <div class="modal-header">
                <h2 style="margin: 0; color: white;">ğŸ”„ é…ç½®å‡çº§æç¤º</h2>
                <button class="close-btn" onclick="closeConfigMigration()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="padding: 20px;">
                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%); border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404; font-size: 16px;">ğŸ“¢ æ£€æµ‹åˆ°æ—§é…ç½®æ–¹å¼</strong><br>
                        <p style="margin: 10px 0 0 0; color: #856404; line-height: 1.6;">
                            æ‚¨å½“å‰ä½¿ç”¨çš„æ˜¯åˆ†ç¦»çš„ç”µå½±/ç”µè§†å‰§è·¯å¾„é…ç½®ã€‚æ–°ç‰ˆæœ¬æ”¯æŒç»Ÿä¸€çš„åª’ä½“åº“è·¯å¾„é…ç½®ï¼Œå¯ä»¥æ›´å¥½åœ°æ”¯æŒäºŒçº§åˆ†ç±»åŠŸèƒ½ã€‚
                        </p>
                    </div>

                    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <strong style="color: #333;">å½“å‰é…ç½®ï¼š</strong><br>
                        <div id="oldConfigDisplay" style="margin-top: 10px; font-size: 14px; color: #666;">
                            <!-- åŠ¨æ€å†…å®¹ -->
                        </div>
                    </div>

                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #e7f3ff 0%, #d4edff 100%); border-radius: 8px; border-left: 4px solid #667eea;">
                        <strong style="color: #667eea;">âœ¨ æ–°é…ç½®çš„ä¼˜åŠ¿ï¼š</strong><br>
                        <ul style="margin: 10px 0 0 20px; color: #333; line-height: 1.8;">
                            <li>ç»Ÿä¸€ç®¡ç†åª’ä½“åº“è·¯å¾„</li>
                            <li>è‡ªåŠ¨æ£€æµ‹ç°æœ‰ç›®å½•ç»“æ„</li>
                            <li>æ”¯æŒäºŒçº§åˆ†ç±»ï¼ˆåŠ¨ä½œã€å–œå‰§ã€ç¾å‰§ã€æ—¥å‰§ç­‰ï¼‰</li>
                            <li>æ”¯æŒä¸­è‹±æ–‡ç›®å½•åç§°</li>
                            <li>æ›´çµæ´»çš„è·¯å¾„é…ç½®</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #28a745;">
                        <strong style="color: #28a745;">ğŸ”’ å®‰å…¨æç¤ºï¼š</strong><br>
                        <p style="margin: 10px 0 0 0; color: #333; line-height: 1.6;">
                            è¿ç§»åï¼Œæ—§é…ç½®å°†ä¿ç•™ä¸ºå¤‡ä»½ã€‚æ‚¨å¯ä»¥éšæ—¶åˆ‡æ¢å›æ—§é…ç½®æ–¹å¼ã€‚
                        </p>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="skipMigration()" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                            æš‚ä¸å‡çº§
                        </button>
                        <button onclick="startMigration()" style="padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">
                            ä¸€é”®å‡çº§é…ç½®
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 115ç½‘ç›˜æµè§ˆå™¨å¼¹çª— -->
    <div id="cloud115BrowserOverlay" class="folder-browser-overlay" style="display: none;" onclick="closeCloud115Browser(event)">
        <div class="folder-browser" onclick="event.stopPropagation()">
            <div class="folder-browser-header">
                <h3>â˜ï¸ é€‰æ‹©115ç½‘ç›˜æ–‡ä»¶å¤¹</h3>
                <button class="folder-browser-close" onclick="closeCloud115Browser()">Ã—</button>
            </div>
            <div class="folder-browser-path" id="cloud115BrowserPath">
                <span onclick="navigateCloud115Folder('0')" style="cursor: pointer; color: #667eea;">ğŸ  æ ¹ç›®å½•</span>
            </div>
            <div class="folder-browser-list" id="cloud115FolderList">
                <div style="text-align: center; padding: 40px; color: #999;">
                    åŠ è½½ä¸­...
                </div>
            </div>
            <div class="folder-browser-footer">
                <button onclick="closeCloud115Browser()" style="background: #999;">å–æ¶ˆ</button>
                <button onclick="selectCloud115Folder()" style="background: #667eea;">é€‰æ‹©æ­¤æ–‡ä»¶å¤¹</button>
            </div>
        </div>
    </div>

    <!-- 115ç½‘ç›˜æ“ä½œå†å²å¼¹çª— -->
    <div id="cloudHistoryOverlay" class="folder-browser-overlay" style="display: none;" onclick="closeCloudHistory(event)">
        <div class="folder-browser" onclick="event.stopPropagation()" style="max-width: 900px;">
            <div class="folder-browser-header">
                <h3>ğŸ“œ 115ç½‘ç›˜æ“ä½œå†å²</h3>
                <button class="folder-browser-close" onclick="closeCloudHistory()">Ã—</button>
            </div>
            
            <div style="padding: 20px;">
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div id="cloudHistoryStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <!-- ç»Ÿè®¡å¡ç‰‡å°†é€šè¿‡ JS åŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- è¿‡æ»¤å™¨ -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <select id="historyTypeFilter" onchange="loadCloudHistory()" style="padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                        <option value="">å…¨éƒ¨æ“ä½œ</option>
                        <option value="rename">é‡å‘½å</option>
                        <option value="move">ç§»åŠ¨</option>
                        <option value="delete">åˆ é™¤</option>
                        <option value="scan">æ‰«æ</option>
                    </select>
                    
                    <input type="date" id="historyDateFrom" onchange="loadCloudHistory()" style="padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                    <span style="line-height: 38px;">è‡³</span>
                    <input type="date" id="historyDateTo" onchange="loadCloudHistory()" style="padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                    
                    <button onclick="exportCloudHistory()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                        ğŸ“¥ å¯¼å‡ºCSV
                    </button>
                </div>
                
                <!-- å†å²è®°å½•åˆ—è¡¨ -->
                <div id="cloudHistoryList" style="max-height: 400px; overflow-y: auto; border: 2px solid #e0e0e0; border-radius: 8px; background: #f8f9fa;">
                    <div style="text-align: center; padding: 40px; color: #999;">
                        åŠ è½½ä¸­...
                    </div>
                </div>
                
                <!-- åˆ†é¡µ -->
                <div id="cloudHistoryPagination" style="display: flex; justify-content: center; gap: 10px; margin-top: 15px;">
                    <!-- åˆ†é¡µæŒ‰é’®å°†é€šè¿‡ JS åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFiles = [];
        let currentFilter = 'all';
        let currentFolder = '';
        let renameLog = [];

        // å½“å‰æ¨¡å—
        let currentModule = 'local';
        
        // ========== é”™è¯¯å¤„ç†å·¥å…·å‡½æ•° ==========
        
        /**
         * æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
         * @param {string} title - é”™è¯¯æ ‡é¢˜
         * @param {string} message - é”™è¯¯æ¶ˆæ¯
         * @param {string} suggestion - å»ºè®®æ“ä½œï¼ˆå¯é€‰ï¼‰
         */
        function showErrorAlert(title, message, suggestion = '') {
            let alertMsg = `âŒ ${title}\n\n${message}`;
            if (suggestion) {
                alertMsg += `\n\nğŸ’¡ å»ºè®®: ${suggestion}`;
            }
            alert(alertMsg);
        }
        
        /**
         * è§£æAPIé”™è¯¯å¹¶è¿”å›å‹å¥½æ¶ˆæ¯
         * @param {Error|string} error - é”™è¯¯å¯¹è±¡æˆ–æ¶ˆæ¯
         * @returns {object} - {message: string, suggestion: string}
         */
        function parseApiError(error) {
            const errorMsg = (error.message || error || '').toLowerCase();
            
            // Cookieç›¸å…³é”™è¯¯
            if (errorMsg.includes('cookie') || errorMsg.includes('è¿‡æœŸ') || errorMsg.includes('æ— æ•ˆ')) {
                return {
                    message: 'Cookieå·²è¿‡æœŸæˆ–æ— æ•ˆ',
                    suggestion: 'è¯·åœ¨è®¾ç½®ä¸­é‡æ–°é…ç½®115ç½‘ç›˜Cookie'
                };
            }
            
            // ç½‘ç»œé”™è¯¯
            if (errorMsg.includes('network') || errorMsg.includes('timeout') || errorMsg.includes('è¿æ¥')) {
                return {
                    message: 'ç½‘ç»œè¿æ¥å¤±è´¥',
                    suggestion: 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•'
                };
            }
            
            // é€Ÿç‡é™åˆ¶
            if (errorMsg.includes('rate limit') || errorMsg.includes('é¢‘ç¹') || errorMsg.includes('429')) {
                return {
                    message: 'è¯·æ±‚è¿‡äºé¢‘ç¹',
                    suggestion: 'è¯·ç¨ç­‰ç‰‡åˆ»åå†è¯•'
                };
            }
            
            // æƒé™é”™è¯¯
            if (errorMsg.includes('permission') || errorMsg.includes('æƒé™') || errorMsg.includes('403')) {
                return {
                    message: 'æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ',
                    suggestion: 'è¯·æ£€æŸ¥Cookieæ˜¯å¦æ­£ç¡®'
                };
            }
            
            // æ–‡ä»¶ä¸å­˜åœ¨
            if (errorMsg.includes('not found') || errorMsg.includes('ä¸å­˜åœ¨') || errorMsg.includes('404')) {
                return {
                    message: 'æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸å­˜åœ¨',
                    suggestion: 'å¯èƒ½å·²è¢«åˆ é™¤æˆ–ç§»åŠ¨'
                };
            }
            
            // æœåŠ¡å™¨é”™è¯¯
            if (errorMsg.includes('500') || errorMsg.includes('502') || errorMsg.includes('503')) {
                return {
                    message: '115æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨',
                    suggestion: 'è¯·ç¨åé‡è¯•'
                };
            }
            
            // é»˜è®¤é”™è¯¯
            return {
                message: error.message || error || 'æ“ä½œå¤±è´¥',
                suggestion: 'è¯·é‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜'
            };
        }
        
        /**
         * æ˜¾ç¤ºæˆåŠŸæç¤º
         * @param {string} message - æˆåŠŸæ¶ˆæ¯
         */
        function showSuccessAlert(message) {
            alert(`âœ… ${message}`);
        }
        
        /**
         * æ˜¾ç¤ºåŠ è½½æç¤º
         * @param {string} elementId - å…ƒç´ ID
         * @param {string} message - åŠ è½½æ¶ˆæ¯
         */
        function showLoading(elementId, message = 'åŠ è½½ä¸­...') {
            const el = document.getElementById(elementId);
            if (el) {
                el.innerHTML = `<div style="text-align: center; padding: 40px; color: #999;">
                    <div style="margin-bottom: 10px;">â³</div>
                    <div>${message}</div>
                </div>`;
            }
        }
        
        /**
         * æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
         * @param {string} elementId - å…ƒç´ ID
         * @param {string} message - é”™è¯¯æ¶ˆæ¯
         */
        function showError(elementId, message) {
            const el = document.getElementById(elementId);
            if (el) {
                el.innerHTML = `<div style="text-align: center; padding: 40px; color: #dc3545;">
                    <div style="margin-bottom: 10px;">âŒ</div>
                    <div>${message}</div>
                </div>`;
            }
        }
        
        // ========== é”™è¯¯å¤„ç†å·¥å…·å‡½æ•°ç»“æŸ ==========
        
        // é¡µé¢åŠ è½½æ—¶ä»localStorageè¯»å–è·¯å¾„
        window.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½å¹¶æ˜¾ç¤ºç‰ˆæœ¬å·
            loadHeaderVersion();
            
            // åŠ è½½æ¨¡å—é€‰æ‹©
            const savedModule = localStorage.getItem('currentModule') || 'local';
            switchModule(savedModule);
            
            // æ‰«æè·¯å¾„
            const savedPath = localStorage.getItem('scanPath');
            const folderPathInput = document.getElementById('folderPath');
            
            if (savedPath) {
                folderPathInput.value = savedPath;
                currentFolder = savedPath;
            } else {
                // é»˜è®¤è·¯å¾„
                const defaultPath = '/vol02/1000-1-b23abde7/å¾…æ•´ç†';
                folderPathInput.value = defaultPath;
                currentFolder = defaultPath;
            }

            // ç”µå½±è¾“å‡ºè·¯å¾„
            const savedMoviePath = localStorage.getItem('movieOutputPath');
            const moviePathInput = document.getElementById('movieOutputPath');
            if (savedMoviePath) {
                moviePathInput.value = savedMoviePath;
            } else {
                moviePathInput.value = '/vol02/1000-1-b23abde7/ç”µå½±';
            }

            // ç”µè§†å‰§è¾“å‡ºè·¯å¾„
            const savedTvPath = localStorage.getItem('tvOutputPath');
            const tvPathInput = document.getElementById('tvOutputPath');
            if (savedTvPath) {
                tvPathInput.value = savedTvPath;
            } else {
                tvPathInput.value = '/vol02/1000-1-b23abde7/ç”µè§†å‰§';
            }

            // åª’ä½“åº“è·¯å¾„ï¼ˆæ–°é…ç½®ï¼‰
            const savedMediaLibraryPath = localStorage.getItem('mediaLibraryPath');
            const mediaLibraryPathInput = document.getElementById('mediaLibraryPath');
            if (savedMediaLibraryPath && mediaLibraryPathInput) {
                mediaLibraryPathInput.value = savedMediaLibraryPath;
            }

            // è¯­è¨€åå¥½
            const savedLanguage = localStorage.getItem('preferredLanguage');
            const languageSelect = document.getElementById('preferredLanguage');
            if (savedLanguage && languageSelect) {
                languageSelect.value = savedLanguage;
            }

            // æ£€æµ‹æ˜¯å¦éœ€è¦é…ç½®è¿ç§»
            checkConfigMigration();
        });
        
        // åŠ è½½å¹¶æ˜¾ç¤ºæ ‡é¢˜ä¸­çš„ç‰ˆæœ¬å·
        async function loadHeaderVersion() {
            try {
                const response = await fetch('/api/get-version', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                if (data.success) {
                    const headerVersionEl = document.getElementById('headerVersion');
                    if (headerVersionEl) {
                        headerVersionEl.textContent = data.current_version;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½ç‰ˆæœ¬å·å¤±è´¥:', error);
            }
        }

        // ä¿å­˜è·¯å¾„åˆ°localStorage
        function savePath() {
            const folderPath = document.getElementById('folderPath').value.trim();
            if (folderPath) {
                localStorage.setItem('scanPath', folderPath);
                currentFolder = folderPath;
            }
        }

        async function scanFolder() {
            const folderPath = currentFolder;

            const autoDelete = document.getElementById('autoDelete').checked;
            const recursive = document.getElementById('recursive').checked;

            showStatus('æ­£åœ¨' + (recursive ? 'é€’å½’' : '') + 'æ‰«æç½‘ç›˜æ–‡ä»¶' + (autoDelete ? 'å¹¶æ¸…ç†ä¸æ”¯æŒçš„æ–‡ä»¶' : '') + 'ï¼ˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰...', 'info');

            try {
                const response = await fetch('/api/scan-all', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        folderPath,
                        autoDelete,
                        recursive
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error);
                }

                currentFiles = data.supported;
                currentFolder = data.folderPath;
                
                const supportedCount = data.supported.length;
                const deletedCount = data.deleted.length;
                const errorCount = data.deleteErrors.length;
                
                let statusMsg = `æ‰¾åˆ° ${supportedCount} ä¸ªæ”¯æŒçš„æ–‡ä»¶`;
                
                if (autoDelete && deletedCount > 0) {
                    statusMsg += `ï¼Œå·²è‡ªåŠ¨åˆ é™¤ ${deletedCount} ä¸ªä¸æ”¯æŒçš„æ–‡ä»¶`;
                    if (errorCount > 0) {
                        statusMsg += `ï¼ˆ${errorCount} ä¸ªåˆ é™¤å¤±è´¥ï¼‰`;
                    }
                } else if (data.unsupported.length > 0) {
                    statusMsg += `ï¼Œå‘ç° ${data.unsupported.length} ä¸ªä¸æ”¯æŒçš„æ–‡ä»¶`;
                }
                
                showStatus(statusMsg, deletedCount > 0 ? 'success' : 'info');
                displayFiles();
            } catch (error) {
                showStatus('é”™è¯¯: ' + error.message, 'error');
            }
        }

        async function deleteFile(filePath, fileName) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${fileName}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }

            showStatus('æ­£åœ¨åˆ é™¤...', 'info');

            try {
                const response = await fetch('/api/delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filePath })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error);
                }

                showStatus('åˆ é™¤æˆåŠŸ', 'success');
                scanFolder();
            } catch (error) {
                showStatus('é”™è¯¯: ' + error.message, 'error');
            }
        }

        async function deleteUnsupportedFiles() {
            const unsupported = currentFiles.filter(f => f.type === 'unsupported');
            
            if (unsupported.length === 0) {
                showStatus('æ²¡æœ‰ä¸æ”¯æŒçš„æ–‡ä»¶', 'info');
                return;
            }

            const fileList = unsupported.map(f => f.name).join('\n');
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ä»¥ä¸‹ ${unsupported.length} ä¸ªä¸æ”¯æŒçš„æ–‡ä»¶å—ï¼Ÿ\n\n${fileList.substring(0, 300)}${fileList.length > 300 ? '\n...' : ''}\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }

            showStatus(`æ­£åœ¨åˆ é™¤ ${unsupported.length} ä¸ªæ–‡ä»¶...`, 'info');

            let success = 0;
            let failed = 0;

            for (const file of unsupported) {
                try {
                    const response = await fetch('/api/delete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ filePath: file.path })
                    });

                    if (response.ok) {
                        success++;
                    } else {
                        failed++;
                    }
                } catch (error) {
                    failed++;
                }
            }

            showStatus(`åˆ é™¤å®Œæˆï¼šæˆåŠŸ ${success} ä¸ªï¼Œå¤±è´¥ ${failed} ä¸ª`, success > 0 ? 'success' : 'error');
            scanFolder();
        }

        function filterFiles(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            displayFiles();
        }

        function displayFiles() {
            const fileList = document.getElementById('fileList');
            const filtered = currentFilter === 'all' 
                ? currentFiles 
                : currentFiles.filter(f => f.type === currentFilter);

            if (filtered.length === 0) {
                fileList.innerHTML = '<p class="no-files">æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶</p>';
                return;
            }

            fileList.innerHTML = filtered.map(file => {
                const safePath = file.path.replace(/'/g, "\\'");
                const safeName = file.name.replace(/'/g, "\\'");
                const icon = file.type === 'media' ? 'ğŸ¬' : 'ğŸ“';
                
                return `
                    <div class="file-item ${file.type}">
                        <div class="file-icon">${icon}</div>
                        <div class="file-info">
                            <div class="file-name">${escapeHtml(file.name)}</div>
                            <div class="file-meta">${formatSize(file.size)} Â· ${formatDate(file.modified)}</div>
                        </div>
                        <button class="rename-btn" onclick="renameFile('${safePath}', '${safeName}')">é‡å‘½å</button>
                        <button class="delete-btn" onclick="deleteFile('${safePath}', '${safeName}')">åˆ é™¤</button>
                    </div>
                `;
            }).join('');
        }

        async function renameFile(filePath, oldName) {
            const newName = prompt('è¾“å…¥æ–°æ–‡ä»¶å:', oldName);
            if (!newName || newName === oldName) return;

            showStatus('æ­£åœ¨é‡å‘½å...', 'info');

            try {
                const response = await fetch('/api/rename', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ oldPath: filePath, newName })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error);
                }

                showStatus('é‡å‘½åæˆåŠŸ', 'success');
                scanFolder();
            } catch (error) {
                showStatus('é”™è¯¯: ' + error.message, 'error');
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp * 1000);
            return date.toLocaleString('zh-CN');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ¨¡å—åˆ‡æ¢å‡½æ•°
        function switchModule(module) {
            currentModule = module;
            localStorage.setItem('currentModule', module);
            
            const localModule = document.getElementById('localModule');
            const cloudModule = document.getElementById('cloudModule');
            const settingsModule = document.getElementById('settingsModule');
            const localTab = document.getElementById('localModuleTab');
            const cloudTab = document.getElementById('cloudModuleTab');
            const settingsTab = document.getElementById('settingsModuleTab');
            
            // éšè—æ‰€æœ‰æ¨¡å—
            localModule.style.display = 'none';
            cloudModule.style.display = 'none';
            settingsModule.style.display = 'none';
            
            // é‡ç½®æ‰€æœ‰é€‰é¡¹å¡æ ·å¼
            const tabs = [localTab, cloudTab, settingsTab];
            tabs.forEach(tab => {
                tab.style.background = '#e9ecef';
                tab.style.color = '#6c757d';
                tab.style.border = '2px solid #dee2e6';
                tab.style.boxShadow = 'none';
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ¨¡å—å¹¶é«˜äº®é€‰é¡¹å¡
            if (module === 'local') {
                localModule.style.display = 'block';
                localTab.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                localTab.style.color = 'white';
                localTab.style.border = 'none';
                localTab.style.boxShadow = '0 4px 15px rgba(102, 126, 234, 0.4)';
            } else if (module === 'cloud') {
                cloudModule.style.display = 'block';
                cloudTab.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                cloudTab.style.color = 'white';
                cloudTab.style.border = 'none';
                cloudTab.style.boxShadow = '0 4px 15px rgba(102, 126, 234, 0.4)';
                // åŠ è½½115ç½‘ç›˜çŠ¶æ€
                loadCloud115Status();
            } else if (module === 'settings') {
                settingsModule.style.display = 'block';
                settingsTab.style.background = 'linear-gradient(135deg, #ff9800 0%, #ff5722 100%)';
                settingsTab.style.color = 'white';
                settingsTab.style.border = 'none';
                settingsTab.style.boxShadow = '0 4px 15px rgba(255, 152, 0, 0.4)';
                // åŠ è½½è®¾ç½®
                loadSettingsToModule();
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            // æ¢å¤ä¸Šæ¬¡é€‰æ‹©çš„æ¨¡å—
            const savedModule = localStorage.getItem('currentModule') || 'local';
            switchModule(savedModule);
        });
        
        // 115ç½‘ç›˜æµè§ˆå™¨ç›¸å…³å˜é‡
        let currentCloud115FolderId = '0';
        let currentCloud115FolderName = 'æ ¹ç›®å½•';
        let cloud115FolderHistory = [{ id: '0', name: 'æ ¹ç›®å½•' }];
        
        // æ‰“å¼€115ç½‘ç›˜æµè§ˆå™¨
        async function openCloud115Browser() {
            const overlay = document.getElementById('cloud115BrowserOverlay');
            overlay.style.display = 'flex';
            
            // é‡ç½®åˆ°æ ¹ç›®å½•
            currentCloud115FolderId = '0';
            currentCloud115FolderName = 'æ ¹ç›®å½•';
            cloud115FolderHistory = [{ id: '0', name: 'æ ¹ç›®å½•' }];
            
            // åŠ è½½æ ¹ç›®å½•
            await loadCloud115Folders('0');
        }
        
        // å…³é—­115ç½‘ç›˜æµè§ˆå™¨
        function closeCloud115Browser(event) {
            if (event && event.target.id !== 'cloud115BrowserOverlay') return;
            const overlay = document.getElementById('cloud115BrowserOverlay');
            overlay.style.display = 'none';
        }
        
        // æ˜¾ç¤º115ç½‘ç›˜æ“ä½œå†å²
        async function showCloudHistory() {
            const overlay = document.getElementById('cloudHistoryOverlay');
            overlay.style.display = 'flex';
            
            // åŠ è½½ç»Ÿè®¡ä¿¡æ¯å’Œå†å²è®°å½•
            await loadCloudHistoryStats();
            await loadCloudHistory();
        }
        
        // å…³é—­115ç½‘ç›˜æ“ä½œå†å²
        function closeCloudHistory(event) {
            if (event && event.target.id !== 'cloudHistoryOverlay') return;
            const overlay = document.getElementById('cloudHistoryOverlay');
            overlay.style.display = 'none';
        }
        
        // åŠ è½½å†å²ç»Ÿè®¡ä¿¡æ¯
        async function loadCloudHistoryStats() {
            try {
                const response = await fetch('/api/cloud/history/stats', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success && data.stats) {
                    const stats = data.stats;
                    const statsEl = document.getElementById('cloudHistoryStats');
                    
                    statsEl.innerHTML = `
                        <div style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${stats.total_operations || 0}</div>
                            <div style="font-size: 12px; opacity: 0.9;">æ€»æ“ä½œæ•°</div>
                        </div>
                        <div style="padding: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 8px; color: white; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${stats.recent_24h || 0}</div>
                            <div style="font-size: 12px; opacity: 0.9;">24å°æ—¶å†…</div>
                        </div>
                        <div style="padding: 15px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 8px; color: white; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${stats.recent_7d || 0}</div>
                            <div style="font-size: 12px; opacity: 0.9;">7å¤©å†…</div>
                        </div>
                        <div style="padding: 15px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 8px; color: white; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${(stats.by_status && stats.by_status.success) || 0}</div>
                            <div style="font-size: 12px; opacity: 0.9;">æˆåŠŸæ“ä½œ</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½å†å²ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½å†å²è®°å½•åˆ—è¡¨
        let currentHistoryPage = 0;
        const historyPageSize = 50;
        
        async function loadCloudHistory(page = 0) {
            currentHistoryPage = page;
            const listEl = document.getElementById('cloudHistoryList');
            listEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">åŠ è½½ä¸­...</div>';
            
            try {
                const typeFilter = document.getElementById('historyTypeFilter').value;
                const dateFrom = document.getElementById('historyDateFrom').value;
                const dateTo = document.getElementById('historyDateTo').value;
                
                const response = await fetch('/api/cloud/history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        limit: historyPageSize,
                        offset: page * historyPageSize,
                        operation_type: typeFilter || undefined,
                        date_from: dateFrom || undefined,
                        date_to: dateTo || undefined
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.history) {
                    const records = data.history;
                    
                    if (records.length === 0) {
                        listEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">æš‚æ— è®°å½•</div>';
                        return;
                    }
                    
                    // æ¸²æŸ“å†å²è®°å½•
                    let html = '<table style="width: 100%; border-collapse: collapse;">';
                    html += '<thead style="background: #f0f0f0; position: sticky; top: 0;">';
                    html += '<tr>';
                    html += '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">æ—¶é—´</th>';
                    html += '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">æ“ä½œ</th>';
                    html += '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">æ–‡ä»¶å</th>';
                    html += '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">çŠ¶æ€</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
                    
                    records.forEach(record => {
                        const opIcon = {
                            'rename': 'âœï¸',
                            'move': 'ğŸ“¦',
                            'delete': 'ğŸ—‘ï¸',
                            'scan': 'ğŸ”'
                        }[record.operation_type] || 'ğŸ“„';
                        
                        const opName = {
                            'rename': 'é‡å‘½å',
                            'move': 'ç§»åŠ¨',
                            'delete': 'åˆ é™¤',
                            'scan': 'æ‰«æ'
                        }[record.operation_type] || record.operation_type;
                        
                        const statusColor = record.status === 'success' ? '#28a745' : '#dc3545';
                        const statusText = record.status === 'success' ? 'âœ“ æˆåŠŸ' : 'âœ— å¤±è´¥';
                        
                        html += '<tr style="border-bottom: 1px solid #eee;">';
                        html += `<td style="padding: 10px; font-size: 12px; color: #666;">${record.timestamp}</td>`;
                        html += `<td style="padding: 10px;">${opIcon} ${opName}</td>`;
                        html += `<td style="padding: 10px; font-size: 13px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${record.file_name}">${record.file_name}</td>`;
                        html += `<td style="padding: 10px; color: ${statusColor}; font-weight: 500;">${statusText}</td>`;
                        html += '</tr>';
                        
                        // å¦‚æœæœ‰æ–°æ–‡ä»¶åï¼Œæ˜¾ç¤ºè¯¦æƒ…
                        if (record.new_name) {
                            html += '<tr style="border-bottom: 1px solid #eee; background: #f8f9fa;">';
                            html += '<td colspan="4" style="padding: 5px 10px 10px 40px; font-size: 12px; color: #666;">';
                            html += `â†’ ${record.new_name}`;
                            html += '</td>';
                            html += '</tr>';
                        }
                        
                        // å¦‚æœæœ‰é”™è¯¯ä¿¡æ¯ï¼Œæ˜¾ç¤º
                        if (record.error) {
                            html += '<tr style="border-bottom: 1px solid #eee; background: #fff3cd;">';
                            html += '<td colspan="4" style="padding: 5px 10px 10px 40px; font-size: 12px; color: #856404;">';
                            html += `âš ï¸ ${record.error}`;
                            html += '</td>';
                            html += '</tr>';
                        }
                    });
                    
                    html += '</tbody>';
                    html += '</table>';
                    
                    listEl.innerHTML = html;
                    
                    // æ›´æ–°åˆ†é¡µ
                    updateHistoryPagination(data.total, data.filtered);
                } else {
                    listEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc3545;">åŠ è½½å¤±è´¥</div>';
                }
            } catch (error) {
                console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                listEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc3545;">åŠ è½½å¤±è´¥: ' + error.message + '</div>';
            }
        }
        
        // æ›´æ–°åˆ†é¡µæŒ‰é’®
        function updateHistoryPagination(total, filtered) {
            const paginationEl = document.getElementById('cloudHistoryPagination');
            const totalPages = Math.ceil(filtered / historyPageSize);
            
            if (totalPages <= 1) {
                paginationEl.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // ä¸Šä¸€é¡µ
            if (currentHistoryPage > 0) {
                html += `<button onclick="loadCloudHistory(${currentHistoryPage - 1})" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">ä¸Šä¸€é¡µ</button>`;
            }
            
            // é¡µç ä¿¡æ¯
            html += `<span style="line-height: 36px; color: #666;">ç¬¬ ${currentHistoryPage + 1} / ${totalPages} é¡µ (å…± ${filtered} æ¡)</span>`;
            
            // ä¸‹ä¸€é¡µ
            if (currentHistoryPage < totalPages - 1) {
                html += `<button onclick="loadCloudHistory(${currentHistoryPage + 1})" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">ä¸‹ä¸€é¡µ</button>`;
            }
            
            paginationEl.innerHTML = html;
        }
        
        // å¯¼å‡ºå†å²è®°å½•ä¸ºCSV
        async function exportCloudHistory() {
            try {
                const typeFilter = document.getElementById('historyTypeFilter').value;
                const dateFrom = document.getElementById('historyDateFrom').value;
                const dateTo = document.getElementById('historyDateTo').value;
                
                const response = await fetch('/api/cloud/history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        limit: 10000,  // å¯¼å‡ºæ‰€æœ‰è®°å½•
                        offset: 0,
                        operation_type: typeFilter || undefined,
                        date_from: dateFrom || undefined,
                        date_to: dateTo || undefined
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.history) {
                    // ç”ŸæˆCSVå†…å®¹
                    let csv = 'æ—¶é—´,æ“ä½œç±»å‹,æ–‡ä»¶å,æ–°æ–‡ä»¶å,çŠ¶æ€,é”™è¯¯ä¿¡æ¯\n';
                    
                    data.history.forEach(record => {
                        const row = [
                            record.timestamp,
                            record.operation_type,
                            `"${record.file_name.replace(/"/g, '""')}"`,
                            record.new_name ? `"${record.new_name.replace(/"/g, '""')}"` : '',
                            record.status,
                            record.error ? `"${record.error.replace(/"/g, '""')}"` : ''
                        ];
                        csv += row.join(',') + '\n';
                    });
                    
                    // ä¸‹è½½CSVæ–‡ä»¶
                    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `115ç½‘ç›˜æ“ä½œå†å²_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                    
                    alert('å¯¼å‡ºæˆåŠŸï¼');
                } else {
                    alert('å¯¼å‡ºå¤±è´¥');
                }
            } catch (error) {
                console.error('å¯¼å‡ºå†å²è®°å½•å¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }
        
        // åŠ è½½115ç½‘ç›˜æ–‡ä»¶å¤¹åˆ—è¡¨
        async function loadCloud115Folders(folderId) {
            const listEl = document.getElementById('cloud115FolderList');
            listEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">åŠ è½½ä¸­...</div>';
            
            try {
                const response = await fetch('/api/cloud/list-files', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ folder_id: folderId, limit: 1000 })
                });
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    const allFiles = data.data.files || [];
                    const folders = allFiles.filter(f => f.is_dir);
                    const files = allFiles.filter(f => !f.is_dir);
                    
                    if (allFiles.length === 0) {
                        listEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">æ­¤æ–‡ä»¶å¤¹ä¸ºç©º</div>';
                        return;
                    }
                    
                    let html = '<div style="padding: 10px;">';
                    
                    // æ·»åŠ è¿”å›ä¸Šçº§æŒ‰é’®
                    if (cloud115FolderHistory.length > 1) {
                        html += `
                            <div onclick="goBackCloud115Folder()" style="padding: 12px; margin-bottom: 5px; background: #f8f9fa; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: background 0.2s;" onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                                <span style="font-size: 20px;">â¬†ï¸</span>
                                <span style="font-weight: 500;">è¿”å›ä¸Šçº§</span>
                            </div>
                        `;
                    }
                    
                    // æ˜¾ç¤ºæ–‡ä»¶å¤¹åˆ—è¡¨
                    folders.forEach(folder => {
                        const fileCount = folder.file_count > 0 ? ` (${folder.file_count}é¡¹)` : '';
                        const safeName = folder.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                        html += `
                            <div onclick="navigateCloud115Folder('${folder.fid}', '${safeName}')" style="padding: 12px; margin-bottom: 5px; background: white; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.2s;" onmouseover="this.style.background='#f0f4ff'; this.style.borderColor='#667eea'" onmouseout="this.style.background='white'; this.style.borderColor='#e0e0e0'">
                                <span style="font-size: 20px;">ğŸ“</span>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; color: #333;">${folder.name}</div>
                                    <small style="color: #999;">${fileCount}</small>
                                </div>
                            </div>
                        `;
                    });
                    
                    // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨
                    files.forEach(file => {
                        const fileSize = file.size > 0 ? formatFileSize(file.size) : '';
                        const safeName = file.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                        const fileIcon = getFileIcon(file.name);
                        html += `
                            <div style="padding: 12px; margin-bottom: 5px; background: white; border: 1px solid #e0e0e0; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 20px;">${fileIcon}</span>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; color: #333;">${file.name}</div>
                                    <small style="color: #999;">${fileSize}</small>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    listEl.innerHTML = html;
                } else {
                    listEl.innerHTML = `<div style="text-align: center; padding: 40px; color: #d32f2f;">${data.error || 'åŠ è½½å¤±è´¥'}</div>`;
                }
            } catch (error) {
                listEl.innerHTML = `<div style="text-align: center; padding: 40px; color: #d32f2f;">åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // å¯¼èˆªåˆ°æŒ‡å®šæ–‡ä»¶å¤¹
        async function navigateCloud115Folder(folderId, folderName = '') {
            currentCloud115FolderId = folderId;
            
            if (folderId === '0') {
                currentCloud115FolderName = 'æ ¹ç›®å½•';
                cloud115FolderHistory = [{ id: '0', name: 'æ ¹ç›®å½•' }];
            } else {
                currentCloud115FolderName = folderName;
                cloud115FolderHistory.push({ id: folderId, name: folderName });
            }
            
            // æ›´æ–°è·¯å¾„æ˜¾ç¤º
            updateCloud115BrowserPath();
            
            // åŠ è½½æ–‡ä»¶å¤¹å†…å®¹
            await loadCloud115Folders(folderId);
        }
        
        // è¿”å›ä¸Šçº§æ–‡ä»¶å¤¹
        async function goBackCloud115Folder() {
            if (cloud115FolderHistory.length > 1) {
                cloud115FolderHistory.pop();
                const parent = cloud115FolderHistory[cloud115FolderHistory.length - 1];
                currentCloud115FolderId = parent.id;
                currentCloud115FolderName = parent.name;
                
                updateCloud115BrowserPath();
                await loadCloud115Folders(currentCloud115FolderId);
            }
        }
        
        // æ›´æ–°è·¯å¾„æ˜¾ç¤º
        function updateCloud115BrowserPath() {
            const pathEl = document.getElementById('cloud115BrowserPath');
            let html = '<span onclick="navigateCloud115Folder(\'0\')" style="cursor: pointer; color: #667eea;">ğŸ  æ ¹ç›®å½•</span>';
            
            for (let i = 1; i < cloud115FolderHistory.length; i++) {
                const folder = cloud115FolderHistory[i];
                html += ` <span style="color: #999;">â€º</span> <span style="color: #333;">${folder.name}</span>`;
            }
            
            pathEl.innerHTML = html;
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return (bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
        }
        
        // æ ¹æ®æ–‡ä»¶æ‰©å±•åè·å–å›¾æ ‡
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const iconMap = {
                'mp4': 'ğŸ¬', 'mkv': 'ğŸ¬', 'avi': 'ğŸ¬', 'mov': 'ğŸ¬', 'wmv': 'ğŸ¬', 'flv': 'ğŸ¬', 'webm': 'ğŸ¬',
                'mp3': 'ğŸµ', 'wav': 'ğŸµ', 'flac': 'ğŸµ', 'aac': 'ğŸµ', 'm4a': 'ğŸµ',
                'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸ–¼ï¸', 'bmp': 'ğŸ–¼ï¸', 'webp': 'ğŸ–¼ï¸',
                'pdf': 'ğŸ“„', 'doc': 'ğŸ“„', 'docx': 'ğŸ“„', 'txt': 'ğŸ“„', 'rtf': 'ğŸ“„',
                'zip': 'ğŸ“¦', 'rar': 'ğŸ“¦', '7z': 'ğŸ“¦', 'tar': 'ğŸ“¦', 'gz': 'ğŸ“¦',
                'exe': 'âš™ï¸', 'msi': 'âš™ï¸', 'apk': 'âš™ï¸',
            };
            return iconMap[ext] || 'ğŸ“„';
        }
        
        // é€‰æ‹©å½“å‰æ–‡ä»¶å¤¹
        function selectCloud115Folder() {
            const input = document.getElementById('cloud115FolderPath');
            const pathText = cloud115FolderHistory.map(f => f.name).join(' / ');
            input.value = pathText;
            input.dataset.folderId = currentCloud115FolderId;
            
            closeCloud115Browser();
        }
        
        // å¼€å§‹115ç½‘ç›˜æ•´ç†
        async function startCloud115Organize() {
            const input = document.getElementById('cloud115FolderPath');
            const folderPath = input.value;
            const folderId = input.dataset.folderId;
            
            if (!folderPath || !folderId) {
                alert('è¯·å…ˆé€‰æ‹©è¦æ•´ç†çš„115ç½‘ç›˜æ–‡ä»¶å¤¹');
                return;
            }
            
            // ç¡®è®¤å¼€å§‹æ•´ç†
            if (!confirm(`ç¡®å®šè¦æ•´ç†æ–‡ä»¶å¤¹: ${folderPath}?\n\nç³»ç»Ÿå°†è‡ªåŠ¨å®Œæˆï¼š\n1. æ‰«ææ–‡ä»¶\n2. è¯†åˆ«æ ‡é¢˜\n3. æ™ºèƒ½å»é‡\n4. æ ‡å‡†åŒ–é‡å‘½å\n5. è‡ªåŠ¨åˆ†ç±»\n\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                return;
            }
            
            // æ˜¾ç¤ºè¿›åº¦å¼¹çª—
            showCloud115Progress();
            
            try {
                // æ­¥éª¤1: æ‰«ææ–‡ä»¶
                updateCloud115Progress(1, 'æ­£åœ¨æ‰«ææ–‡ä»¶å¤¹...', 0);
                const scanResult = await fetch('/api/cloud/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        folder_id: folderId,
                        recursive: true,
                        max_depth: 10
                    })
                });
                
                const scanData = await scanResult.json();
                if (!scanData.success) {
                    throw new Error(scanData.error || 'æ‰«æå¤±è´¥');
                }
                
                const stats = scanData.data.stats;
                updateCloud115Progress(1, `æ‰«æå®Œæˆï¼šæ‰¾åˆ° ${stats.video_files} ä¸ªè§†é¢‘æ–‡ä»¶`, 100);
                
                if (stats.video_files === 0) {
                    alert('æœªæ‰¾åˆ°è§†é¢‘æ–‡ä»¶');
                    closeCloud115Progress();
                    return;
                }
                
                // æ­¥éª¤2-5: æ™ºèƒ½æ•´ç†ï¼ˆå»é‡ã€é‡å‘½åã€åˆ†ç±»ï¼‰
                updateCloud115Progress(2, 'æ­£åœ¨æ™ºèƒ½æ•´ç†...', 0);
                const organizeResult = await fetch('/api/cloud/smart-organize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        folder_id: folderId,
                        target_folder_id: folderId,
                        enable_rename: true,
                        enable_dedupe: true
                    })
                });
                
                const organizeData = await organizeResult.json();
                if (!organizeData.success) {
                    throw new Error(organizeData.error || 'æ•´ç†å¤±è´¥');
                }
                
                const result = organizeData.data;
                updateCloud115Progress(2, 'æ•´ç†å®Œæˆï¼', 100);
                
                // æ˜¾ç¤ºç»“æœ
                const summary = `
æ•´ç†å®Œæˆï¼

ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ï¼š
- æ‰«ææ–‡ä»¶ï¼š${result.scan_stats.total_files} ä¸ª
- è§†é¢‘æ–‡ä»¶ï¼š${result.scan_stats.video_files} ä¸ª
- åˆ é™¤é‡å¤ï¼š${result.duplicates_removed} ä¸ª
- é‡å‘½åï¼š${result.files_renamed} ä¸ª
- ç§»åŠ¨åˆ†ç±»ï¼š${result.files_moved} ä¸ª

âœ… æ‰€æœ‰æ–‡ä»¶å·²æŒ‰åˆ†ç±»æ•´ç†å®Œæˆï¼
                `.trim();
                
                setTimeout(() => {
                    closeCloud115Progress();
                    alert(summary);
                }, 1000);
                
            } catch (error) {
                console.error('æ•´ç†å¤±è´¥:', error);
                updateCloud115Progress(0, `é”™è¯¯: ${error.message}`, 0);
                setTimeout(() => {
                    closeCloud115Progress();
                    alert(`æ•´ç†å¤±è´¥: ${error.message}`);
                }, 2000);
            }
        }
        
        // æ˜¾ç¤º115ç½‘ç›˜æ•´ç†è¿›åº¦å¼¹çª—
        function showCloud115Progress() {
            const modal = document.getElementById('cloud115ProgressModal');
            if (!modal) {
                // åˆ›å»ºè¿›åº¦å¼¹çª—
                const modalHtml = `
                    <div id="cloud115ProgressModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
                        <div style="background: white; padding: 30px; border-radius: 12px; min-width: 400px; max-width: 600px;">
                            <h3 style="margin: 0 0 20px 0; color: #333;">115ç½‘ç›˜æ•´ç†è¿›åº¦</h3>
                            <div id="cloud115ProgressSteps"></div>
                            <div style="margin-top: 20px; text-align: right;">
                                <button onclick="closeCloud115Progress()" style="padding: 8px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">å…³é—­</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }
            
            // åˆå§‹åŒ–æ­¥éª¤
            const stepsHtml = `
                <div class="progress-step" id="step1">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span style="font-weight: 500;">1. æ‰«ææ–‡ä»¶</span>
                        <span id="step1-status" style="margin-left: auto; color: #999;">ç­‰å¾…ä¸­...</span>
                    </div>
                    <div style="background: #f0f0f0; height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="step1-bar" style="background: #667eea; height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                </div>
                <div class="progress-step" id="step2" style="margin-top: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span style="font-weight: 500;">2. æ™ºèƒ½æ•´ç†</span>
                        <span id="step2-status" style="margin-left: auto; color: #999;">ç­‰å¾…ä¸­...</span>
                    </div>
                    <div style="background: #f0f0f0; height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="step2-bar" style="background: #667eea; height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                </div>
            `;
            document.getElementById('cloud115ProgressSteps').innerHTML = stepsHtml;
            document.getElementById('cloud115ProgressModal').style.display = 'flex';
        }
        
        // æ›´æ–°115ç½‘ç›˜æ•´ç†è¿›åº¦
        function updateCloud115Progress(step, status, progress) {
            const statusEl = document.getElementById(`step${step}-status`);
            const barEl = document.getElementById(`step${step}-bar`);
            
            if (statusEl) statusEl.textContent = status;
            if (barEl) barEl.style.width = `${progress}%`;
        }
        
        // å…³é—­115ç½‘ç›˜æ•´ç†è¿›åº¦å¼¹çª—
        function closeCloud115Progress() {
            const modal = document.getElementById('cloud115ProgressModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // æŠ˜å /å±•å¼€åŠŸèƒ½è¯´æ˜
        function toggleFunctionInfo() {
            const content = document.getElementById('functionInfoContent');
            const toggle = document.getElementById('functionInfoToggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = 'â–²';
            } else {
                content.style.display = 'none';
                toggle.textContent = 'â–¼';
            }
        }
        
        // è¿›åº¦å¼¹çª—ç®¡ç†
        let progressModal = null;
        let currentStepIndex = 0;
        let isProcessing = false;
        
        const steps = [
            { icon: 'ğŸ“‚', title: 'æ™ºèƒ½æ‰«æ', detail: 'æ‰«æå¾…æ•´ç†ç›®å½•ä¸­çš„æ‰€æœ‰åª’ä½“æ–‡ä»¶' },
            { icon: 'ğŸŒ', title: 'ä¸­æ–‡æ ‡é¢˜è¯†åˆ«', detail: 'é€šè¿‡è±†ç“£å’ŒTMDBè·å–ä¸­æ–‡æ ‡é¢˜' },
            { icon: 'ğŸ¯', title: 'æ™ºèƒ½å»é‡', detail: 'è¯†åˆ«é‡å¤æ–‡ä»¶ï¼Œä¿ç•™æœ€ä½³è´¨é‡ç‰ˆæœ¬' },
            { icon: 'ğŸ“', title: 'æ ‡å‡†åŒ–é‡å‘½å', detail: 'æŒ‰ç…§è§„èŒƒæ ¼å¼ç”Ÿæˆæ–°æ–‡ä»¶å' },
            { icon: 'ğŸ“', title: 'æ™ºèƒ½åˆ†ç±»', detail: 'æ ¹æ®å…ƒæ•°æ®ç¡®å®šåˆ†ç±»ç›®å½•' },
            { icon: 'ğŸšš', title: 'è‡ªåŠ¨ç§»åŠ¨', detail: 'ç§»åŠ¨æ–‡ä»¶åˆ°ç›®æ ‡åˆ†ç±»ç›®å½•' },
            { icon: 'âš”ï¸', title: 'å†²çªå¤„ç†', detail: 'å¤„ç†åŒåæ–‡ä»¶å†²çª' },
            { icon: 'ğŸ§¹', title: 'è‡ªåŠ¨æ¸…ç†', detail: 'æ¸…ç†è·³è¿‡çš„æ–‡ä»¶å’Œç©ºæ–‡ä»¶å¤¹' }
        ];
        
        function showProgressModal() {
            progressModal = document.getElementById('progressModal');
            progressModal.style.display = 'flex';
            
            // å¦‚æœæ­£åœ¨å¤„ç†ï¼Œæ˜¾ç¤ºå½“å‰è¿›åº¦
            if (isProcessing) {
                updateProgressDisplay();
            } else {
                resetProgressDisplay();
            }
        }
        
        function closeProgressModal() {
            if (progressModal) {
                progressModal.style.display = 'none';
            }
        }
        
        // è®¾ç½®å¼¹çª—ç®¡ç†
        async function showSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = 'flex';
            
            // åŠ è½½å½“å‰è®¾ç½®
            try {
                const response = await fetch('/api/get-settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                if (data.success && data.settings) {
                    document.getElementById('tmdbApiKey').value = data.settings.tmdb_api_key || '';
                    document.getElementById('tmdbProxy').value = data.settings.tmdb_proxy || '';
                    document.getElementById('tmdbProxyType').value = data.settings.tmdb_proxy_type || 'http';
                    document.getElementById('doubanCookie').value = data.settings.douban_cookie || '';
                    document.getElementById('updateProxy').value = data.settings.update_proxy || '';
                    document.getElementById('updateProxyEnabled').checked = data.settings.update_proxy_enabled || false;
                    document.getElementById('autoRestartAfterUpdate').checked = data.settings.auto_restart_after_update !== false;
                    
                    // åŠ è½½115ç½‘ç›˜Cookieï¼ˆæ˜¾ç¤ºä¸ºå·²é…ç½®çŠ¶æ€ï¼Œä¸æ˜¾ç¤ºå®é™…å†…å®¹ï¼‰
                    if (data.settings.cloud_115_cookie) {
                        document.getElementById('cloud115Cookie').value = ''; // ä¸æ˜¾ç¤ºåŠ å¯†çš„Cookie
                        document.getElementById('cloud115Cookie').placeholder = 'å·²é…ç½®ï¼ˆé‡æ–°è¾“å…¥å¯æ›´æ–°ï¼‰';
                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        const statusEl = document.getElementById('cloud115Status');
                        statusEl.innerHTML = 'âœ… å·²é…ç½®<br><small>åˆ·æ–°é¡µé¢åè¯·é‡æ–°éªŒè¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</small>';
                        statusEl.style.background = '#d4edda';
                        statusEl.style.color = '#155724';
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
            }
            
            // åŠ è½½å½“å‰ç‰ˆæœ¬
            loadCurrentVersion();
        }
        
        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = 'none';
        }
        
        // 115ç½‘ç›˜CookieéªŒè¯ï¼ˆè®¾ç½®å¼¹çª—ä¸­ï¼‰
        async function verifyCloud115Cookie() {
            const cookie = document.getElementById('cloud115Cookie').value.trim();
            
            if (!cookie) {
                alert('è¯·å…ˆè¾“å…¥115ç½‘ç›˜Cookie');
                return;
            }
            
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'ğŸ” éªŒè¯ä¸­...';
            
            const statusEl = document.getElementById('cloud115Status');
            statusEl.textContent = 'éªŒè¯ä¸­...';
            statusEl.style.background = '#fff3cd';
            statusEl.style.color = '#856404';
            
            try {
                const response = await fetch('/api/cloud/verify-cookie', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cookie })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const userInfo = data.user_info;
                    const spaceUsed = (userInfo.space_used / (1024**3)).toFixed(2);
                    const spaceTotal = (userInfo.space_total / (1024**3)).toFixed(2);
                    
                    statusEl.innerHTML = `
                        âœ… å·²ç™»å½•<br>
                        <small>ç”¨æˆ·: ${userInfo.username || userInfo.user_id}</small><br>
                        <small>ç©ºé—´: ${spaceUsed}GB / ${spaceTotal}GB</small>
                    `;
                    statusEl.style.background = '#d4edda';
                    statusEl.style.color = '#155724';
                    
                    alert('âœ… CookieéªŒè¯æˆåŠŸï¼\n\nç”¨æˆ·: ' + (userInfo.username || userInfo.user_id) + '\nç©ºé—´: ' + spaceUsed + 'GB / ' + spaceTotal + 'GB');
                } else {
                    statusEl.textContent = 'âŒ ' + (data.error || 'Cookieæ— æ•ˆ');
                    statusEl.style.background = '#f8d7da';
                    statusEl.style.color = '#721c24';
                    
                    alert('âŒ CookieéªŒè¯å¤±è´¥\n\n' + (data.error || 'Cookieæ— æ•ˆæˆ–å·²è¿‡æœŸ'));
                }
            } catch (error) {
                statusEl.textContent = 'âŒ éªŒè¯å¤±è´¥';
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
                
                alert('âŒ éªŒè¯å¤±è´¥\n\n' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ” éªŒè¯Cookie';
            }
        }
        
        // è‡ªåŠ¨éªŒè¯115ç½‘ç›˜Cookieï¼ˆå¸¦é˜²æŠ–ï¼‰
        let cloud115VerifyTimer = null;
        async function autoVerifyCloud115Cookie() {
            const cookie = document.getElementById('cloud115CookieInline').value.trim();
            const indicator = document.getElementById('cloud115StatusIndicator');
            const statusText = document.getElementById('cloud115StatusText');
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (cloud115VerifyTimer) {
                clearTimeout(cloud115VerifyTimer);
            }
            
            if (!cookie) {
                indicator.style.background = '#ccc';
                statusText.textContent = 'æœªé…ç½®';
                statusText.style.color = '#666';
                return;
            }
            
            // æ˜¾ç¤ºç­‰å¾…çŠ¶æ€
            indicator.style.background = '#ffc107';
            statusText.textContent = 'éªŒè¯ä¸­...';
            statusText.style.color = '#856404';
            
            // è®¾ç½®é˜²æŠ–ï¼š1ç§’åè‡ªåŠ¨éªŒè¯
            cloud115VerifyTimer = setTimeout(async () => {
                try {
                    const response = await fetch('/api/cloud/verify-cookie', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ cookie })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        const userInfo = data.user_info;
                        const spaceUsed = (userInfo.space_used / (1024**3)).toFixed(2);
                        const spaceTotal = (userInfo.space_total / (1024**3)).toFixed(2);
                        
                        indicator.style.background = '#28a745';
                        statusText.textContent = `å·²ç™»å½• | ${userInfo.username || userInfo.user_id} | ${spaceUsed}GB/${spaceTotal}GB`;
                        statusText.style.color = '#155724';
                    } else {
                        indicator.style.background = '#dc3545';
                        statusText.textContent = 'Cookieæ— æ•ˆ';
                        statusText.style.color = '#721c24';
                    }
                } catch (error) {
                    indicator.style.background = '#dc3545';
                    statusText.textContent = 'éªŒè¯å¤±è´¥';
                    statusText.style.color = '#721c24';
                }
            }, 1000); // 1ç§’é˜²æŠ–
        }
        
        // åˆ‡æ¢Cookieæ˜¾ç¤º/éšè—
        function toggleCookieVisibility() {
            const input = document.getElementById('cloud115CookieInline');
            const btn = event.target;
            
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'ğŸ™ˆ'; // é—­çœ¼ï¼ˆéšè—ï¼‰
                btn.title = 'éšè—Cookie';
            } else {
                input.type = 'password';
                btn.textContent = 'ğŸ‘ï¸'; // ççœ¼ï¼ˆæ˜¾ç¤ºï¼‰
                btn.title = 'æ˜¾ç¤ºCookie';
            }
        }
        
        // å¤åˆ¶Cookie
        async function copyCookie() {
            const input = document.getElementById('cloud115CookieInline');
            const cookie = input.value;
            
            if (!cookie) {
                alert('Cookieä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(cookie);
                alert('âœ… Cookieå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (error) {
                // é™çº§æ–¹æ¡ˆ
                input.select();
                document.execCommand('copy');
                alert('âœ… Cookieå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }
        
        // æ˜¾ç¤ºäºŒç»´ç ç™»å½•å¼¹çª—
        function showQRCodeLogin() {
            const modal = document.getElementById('qrcodeLoginModal');
            if (!modal) {
                // åˆ›å»ºäºŒç»´ç ç™»å½•å¼¹çª—
                const modalHtml = `
                    <div id="qrcodeLoginModal" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
                        <div style="background: white; padding: 30px; border-radius: 12px; min-width: 400px; max-width: 500px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="margin: 0; color: #333;">ğŸ“± 115ç½‘ç›˜æ‰«ç ç™»å½•</h3>
                                <button onclick="closeQRCodeLogin()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">Ã—</button>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <p style="color: #666; margin-bottom: 15px;">è¯·é€‰æ‹©æ‰«ç æ–¹å¼ï¼š</p>
                                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                                    <button onclick="selectQRType('wechatmini')" class="qr-type-btn" data-type="wechatmini" style="flex: 1; min-width: 100px; padding: 10px; border: 2px solid #07c160; border-radius: 8px; background: #f0f9ff; cursor: pointer; transition: all 0.2s; font-weight: 600; color: #07c160;">å¾®ä¿¡å°ç¨‹åº â­</button>
                                    <button onclick="selectQRType('alipaymini')" class="qr-type-btn" data-type="alipaymini" style="flex: 1; min-width: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; transition: all 0.2s;">æ”¯ä»˜å®</button>
                                    <button onclick="selectQRType('android')" class="qr-type-btn" data-type="android" style="flex: 1; min-width: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; transition: all 0.2s;">å®‰å“APP</button>
                                    <button onclick="selectQRType('ios')" class="qr-type-btn" data-type="ios" style="flex: 1; min-width: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; transition: all 0.2s;">iOS APP</button>
                                    <button onclick="selectQRType('tv')" class="qr-type-btn" data-type="tv" style="flex: 1; min-width: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; transition: all 0.2s;">PADç«¯</button>
                                </div>
                            </div>
                            
                            <div id="qrcodeContainer" style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                                <p style="color: #999;">ğŸ‘† è¯·å…ˆé€‰æ‹©æ‰«ç æ–¹å¼</p>
                                <small style="color: #999; margin-top: 10px;">æ¨èä½¿ç”¨å¾®ä¿¡å°ç¨‹åºï¼ŒCookieæœ‰æ•ˆæœŸæ›´é•¿</small>
                            </div>
                            
                            <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #2196f3;">
                                <small style="color: #1976d2; line-height: 1.6;">
                                    <strong>ğŸ’¡ ä½¿ç”¨æç¤ºï¼š</strong><br>
                                    â€¢ æ¨èä½¿ç”¨å¾®ä¿¡å°ç¨‹åºæˆ–æ”¯ä»˜å®å°ç¨‹åºæ‰«ç <br>
                                    â€¢ å°ç¨‹åºCookieæœ‰æ•ˆæœŸæ›´é•¿ï¼Œä¸æ˜“è¿‡æœŸ<br>
                                    â€¢ ä½¿ç”¨115æ‰‹æœºå®¢æˆ·ç«¯æ‰«ç åç‚¹å‡»ç¡®è®¤<br>
                                    â€¢ Cookieä¼šè‡ªåŠ¨ä¿å­˜å¹¶éªŒè¯
                                </small>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            } else {
                modal.style.display = 'flex';
            }
        }
        
        // å…³é—­äºŒç»´ç ç™»å½•å¼¹çª—
        function closeQRCodeLogin() {
            const modal = document.getElementById('qrcodeLoginModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // é€‰æ‹©äºŒç»´ç ç±»å‹
        async function selectQRType(type) {
            // æ›´æ–°æŒ‰é’®æ ·å¼
            document.querySelectorAll('.qr-type-btn').forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.style.borderColor = '#667eea';
                    btn.style.background = '#f0f4ff';
                    btn.style.color = '#667eea';
                    btn.style.fontWeight = '600';
                } else {
                    btn.style.borderColor = '#e0e0e0';
                    btn.style.background = 'white';
                    btn.style.color = '#333';
                    btn.style.fontWeight = 'normal';
                }
            });
            
            const container = document.getElementById('qrcodeContainer');
            container.innerHTML = '<p style="color: #667eea;">ğŸ”„ æ­£åœ¨ç”ŸæˆäºŒç»´ç ...</p>';
            
            try {
                // è°ƒç”¨åç«¯APIç”ŸæˆäºŒç»´ç 
                const response = await fetch('/api/cloud/generate-qrcode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // æ˜¾ç¤ºäºŒç»´ç 
                    container.innerHTML = `
                        <img src="${data.qrcode}" style="width: 250px; height: 250px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <p style="color: #667eea; margin-top: 15px; font-weight: 500;">è¯·ä½¿ç”¨115æ‰‹æœºå®¢æˆ·ç«¯æ‰«ç </p>
                        <p style="color: #999; font-size: 12px;">ç­‰å¾…æ‰«ç ...</p>
                    `;
                    
                    // å¼€å§‹è½®è¯¢æ£€æŸ¥ç™»å½•çŠ¶æ€
                    checkQRCodeStatus(data.session_id);
                } else {
                    container.innerHTML = `<p style="color: #dc3545;">âŒ ${data.error || 'ç”ŸæˆäºŒç»´ç å¤±è´¥'}</p>`;
                }
            } catch (error) {
                container.innerHTML = `
                    <p style="color: #dc3545;">âŒ åŠŸèƒ½å¼€å‘ä¸­</p>
                    <small style="color: #999; margin-top: 10px; display: block;">æ­¤åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒï¼Œæ•¬è¯·æœŸå¾…</small>
                `;
            }
        }
        
        // æ£€æŸ¥äºŒç»´ç æ‰«ç çŠ¶æ€
        let qrcodeCheckTimer = null;
        async function checkQRCodeStatus(sessionId) {
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (qrcodeCheckTimer) {
                clearInterval(qrcodeCheckTimer);
            }
            
            // æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
            qrcodeCheckTimer = setInterval(async () => {
                try {
                    const response = await fetch('/api/cloud/check-qrcode', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ session_id: sessionId })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success && data.cookie) {
                        // æ‰«ç æˆåŠŸï¼Œè·å–åˆ°Cookie
                        clearInterval(qrcodeCheckTimer);
                        
                        // å¡«å……Cookieå¹¶éªŒè¯
                        document.getElementById('cloud115CookieInline').value = data.cookie;
                        autoVerifyCloud115Cookie();
                        
                        // å…³é—­å¼¹çª—
                        closeQRCodeLogin();
                        alert('âœ… æ‰«ç ç™»å½•æˆåŠŸï¼Cookieå·²è‡ªåŠ¨å¡«å……å¹¶éªŒè¯');
                    } else if (data.expired) {
                        // äºŒç»´ç è¿‡æœŸ
                        clearInterval(qrcodeCheckTimer);
                        document.getElementById('qrcodeContainer').innerHTML = `
                            <p style="color: #dc3545;">â° äºŒç»´ç å·²è¿‡æœŸ</p>
                            <button onclick="selectQRType('${data.type}')" style="margin-top: 15px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                ğŸ”„ åˆ·æ–°äºŒç»´ç 
                            </button>
                        `;
                    }
                } catch (error) {
                    console.error('æ£€æŸ¥äºŒç»´ç çŠ¶æ€å¤±è´¥:', error);
                }
            }, 2000);
        }
        
        // åŠ è½½115ç½‘ç›˜CookieçŠ¶æ€ï¼ˆé¡µé¢åŠ è½½æ—¶è°ƒç”¨ï¼‰
        async function loadCloud115Status() {
            try {
                const response = await fetch('/api/get-settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                if (data.success && data.settings && data.settings.cloud_115_cookie) {
                    // æ˜¾ç¤ºå·²é…ç½®çŠ¶æ€
                    const indicator = document.getElementById('cloud115StatusIndicator');
                    const statusText = document.getElementById('cloud115StatusText');
                    
                    if (indicator && statusText) {
                        indicator.style.background = '#28a745';
                        statusText.textContent = 'å·²é…ç½®ï¼ˆå¯é‡æ–°è¾“å…¥æ›´æ–°ï¼‰';
                        statusText.style.color = '#155724';
                    }
                }
            } catch (error) {
                console.error('åŠ è½½115ç½‘ç›˜çŠ¶æ€å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½è®¾ç½®åˆ°è®¾ç½®æ¨¡å—
        async function loadSettingsToModule() {
            try {
                const response = await fetch('/api/get-settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                if (data.success && data.settings) {
                    document.getElementById('tmdbApiKeySettings').value = data.settings.tmdb_api_key || '';
                    document.getElementById('tmdbProxySettings').value = data.settings.tmdb_proxy || '';
                    document.getElementById('tmdbProxyEnabledSettings').checked = !!data.settings.tmdb_proxy;
                    document.getElementById('doubanCookieSettings').value = data.settings.douban_cookie || '';
                    document.getElementById('updateProxySettings').value = data.settings.update_proxy || '';
                    document.getElementById('updateProxyEnabledSettings').checked = data.settings.update_proxy_enabled || false;
                    document.getElementById('autoRestartAfterUpdateSettings').checked = data.settings.auto_restart_after_update !== false;
                    
                    // åŠ è½½ç‰ˆæœ¬å·
                    loadVersionToSettings();
                }
            } catch (error) {
                console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½ç‰ˆæœ¬å·åˆ°è®¾ç½®æ¨¡å—
        async function loadVersionToSettings() {
            try {
                const response = await fetch('/api/get-version', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                if (data.success && data.current_version) {
                    // åç«¯å·²ç»åŒ…å« 'v' å‰ç¼€ï¼Œä¸éœ€è¦å†æ·»åŠ 
                    document.getElementById('currentVersionSettings').textContent = data.current_version;
                } else {
                    document.getElementById('currentVersionSettings').textContent = 'è·å–å¤±è´¥';
                }
            } catch (error) {
                console.error('åŠ è½½ç‰ˆæœ¬å¤±è´¥:', error);
                document.getElementById('currentVersionSettings').textContent = 'è·å–å¤±è´¥';
            }
        }
        
        // ä»è®¾ç½®æ¨¡å—ä¿å­˜è®¾ç½®
        async function saveSettingsFromModule() {
            const settings = {
                tmdb_api_key: document.getElementById('tmdbApiKeySettings').value.trim(),
                tmdb_proxy: document.getElementById('tmdbProxyEnabledSettings').checked ? document.getElementById('tmdbProxySettings').value.trim() : '',
                tmdb_proxy_type: 'http',
                douban_cookie: document.getElementById('doubanCookieSettings').value.trim(),
                update_proxy: document.getElementById('updateProxySettings').value.trim(),
                update_proxy_enabled: document.getElementById('updateProxyEnabledSettings').checked,
                auto_restart_after_update: document.getElementById('autoRestartAfterUpdateSettings').checked
            };
            
            try {
                const response = await fetch('/api/save-settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ settings })
                });
                
                const data = await response.json();
                if (data.success) {
                    showSuccessAlert('è®¾ç½®å·²ä¿å­˜ï¼\n\næç¤ºï¼šæŸäº›è®¾ç½®å¯èƒ½éœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆã€‚');
                } else {
                    showErrorAlert('ä¿å­˜å¤±è´¥', data.error || 'æœªçŸ¥é”™è¯¯');
                }
            } catch (error) {
                showErrorAlert('ä¿å­˜å¤±è´¥', error.message);
            }
        }
        
        // åœ¨è®¾ç½®æ¨¡å—ä¸­æ£€æŸ¥æ›´æ–°
        async function checkForUpdatesInSettings() {
            try {
                const btn = event.target;
                btn.disabled = true;
                btn.textContent = 'ğŸ” æ£€æŸ¥ä¸­...';
                
                const response = await fetch('/api/check-update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.has_update) {
                    if (confirm(`å‘ç°æ–°ç‰ˆæœ¬ï¼\n\nå½“å‰ç‰ˆæœ¬: v${data.current_version}\næœ€æ–°ç‰ˆæœ¬: v${data.latest_version}\n\næ˜¯å¦ç«‹å³æ›´æ–°ï¼Ÿ`)) {
                        await executeUpdateInSettings();
                    }
                } else {
                    showSuccessAlert('å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼\n\nå½“å‰ç‰ˆæœ¬: v' + data.current_version);
                }
            } catch (error) {
                showErrorAlert('æ£€æŸ¥æ›´æ–°å¤±è´¥', error.message);
            } finally {
                const btn = event.target;
                btn.disabled = false;
                btn.textContent = 'ğŸ” æ£€æŸ¥æ›´æ–°';
            }
        }
        
        // åœ¨è®¾ç½®æ¨¡å—ä¸­æ‰§è¡Œæ›´æ–°
        async function executeUpdateInSettings() {
            try {
                const response = await fetch('/api/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccessAlert('æ›´æ–°æˆåŠŸï¼\n\nç³»ç»Ÿå°†åœ¨ 3 ç§’åè‡ªåŠ¨é‡å¯...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                } else {
                    showErrorAlert('æ›´æ–°å¤±è´¥', data.error || 'æœªçŸ¥é”™è¯¯');
                }
            } catch (error) {
                showErrorAlert('æ›´æ–°å¤±è´¥', error.message);
            }
        }
        
        // æŸ¥çœ‹æ›´æ–°å†å²
        async function viewUpdateHistory() {
            try {
                const response = await fetch('/api/update-history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success && data.history) {
                    let historyText = 'ğŸ“œ æ›´æ–°å†å²è®°å½•\n\n';
                    data.history.forEach((record, index) => {
                        historyText += `${index + 1}. ${record.timestamp}\n`;
                        historyText += `   ç‰ˆæœ¬: ${record.old_version} â†’ ${record.new_version}\n`;
                        historyText += `   çŠ¶æ€: ${record.status === 'success' ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}\n\n`;
                    });
                    alert(historyText);
                } else {
                    alert('æš‚æ— æ›´æ–°å†å²è®°å½•');
                }
            } catch (error) {
                showErrorAlert('è·å–æ›´æ–°å†å²å¤±è´¥', error.message);
            }
        }
        
        async function saveSettings() {
            const settings = {
                tmdb_api_key: document.getElementById('tmdbApiKey').value.trim(),
                tmdb_proxy: document.getElementById('tmdbProxy').value.trim(),
                tmdb_proxy_type: document.getElementById('tmdbProxyType').value,
                douban_cookie: document.getElementById('doubanCookie').value.trim(),
                update_proxy: document.getElementById('updateProxy').value.trim(),
                update_proxy_enabled: document.getElementById('updateProxyEnabled').checked,
                auto_restart_after_update: document.getElementById('autoRestartAfterUpdate').checked
            };
            
            // å¦‚æœè¾“å…¥äº†115ç½‘ç›˜Cookieï¼Œå…ˆéªŒè¯å†ä¿å­˜
            const cloud115Cookie = document.getElementById('cloud115Cookie').value.trim();
            if (cloud115Cookie) {
                try {
                    const verifyResponse = await fetch('/api/cloud/verify-cookie', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ cookie: cloud115Cookie })
                    });
                    
                    const verifyData = await verifyResponse.json();
                    if (!verifyData.success) {
                        alert('âŒ 115ç½‘ç›˜CookieéªŒè¯å¤±è´¥\n\n' + (verifyData.error || 'Cookieæ— æ•ˆæˆ–å·²è¿‡æœŸ') + '\n\nè¯·å…ˆéªŒè¯Cookieåå†ä¿å­˜è®¾ç½®ã€‚');
                        return;
                    }
                    
                    // Cookieå·²åœ¨éªŒè¯æ—¶ä¿å­˜ï¼Œè¿™é‡Œä¸éœ€è¦å†æ¬¡ä¿å­˜
                    alert('âœ… 115ç½‘ç›˜Cookieå·²éªŒè¯å¹¶ä¿å­˜ï¼');
                } catch (error) {
                    alert('âŒ 115ç½‘ç›˜CookieéªŒè¯å¤±è´¥\n\n' + error.message);
                    return;
                }
            }
            
            try {
                const response = await fetch('/api/save-settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ settings })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('âœ… è®¾ç½®å·²ä¿å­˜ï¼\n\næç¤ºï¼šæŸäº›è®¾ç½®å¯èƒ½éœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆã€‚');
                    closeSettingsModal();
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }
        
        function resetProgressDisplay() {
            // é‡ç½®æ•´ä½“è¿›åº¦
            document.getElementById('overallProgress').style.width = '0%';
            document.getElementById('overallStatus').textContent = 'å‡†å¤‡å¼€å§‹...';
            
            // é‡ç½®å½“å‰æ­¥éª¤
            const currentStep = document.getElementById('currentStep');
            currentStep.innerHTML = `
                <div class="step-icon">ğŸ“‚</div>
                <div class="step-info">
                    <div class="step-title">ç­‰å¾…å¼€å§‹</div>
                    <div class="step-detail">ç‚¹å‡»"ä¸€é”®æ•´ç†å…¥åº“"å¼€å§‹å¤„ç†</div>
                </div>
            `;
            
            // é‡ç½®è¯¦ç»†è¿›åº¦
            const progressItems = document.querySelectorAll('.progress-item');
            progressItems.forEach((item, index) => {
                item.className = 'progress-item';
                const status = item.querySelector('.progress-status');
                status.className = 'progress-status waiting';
                status.textContent = 'ç­‰å¾…ä¸­';
            });
            
            // é‡ç½®æ—¥å¿—
            const detailLog = document.getElementById('detailLog');
            if (detailLog) {
                detailLog.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">ç­‰å¾…å¼€å§‹å¤„ç†...</div>';
            }
        }
        
        function updateProgressDisplay() {
            // æ›´æ–°æ•´ä½“è¿›åº¦
            const progress = Math.round((currentStepIndex / steps.length) * 100);
            document.getElementById('overallProgress').style.width = progress + '%';
            document.getElementById('overallStatus').textContent = `æ­£åœ¨å¤„ç†... ${progress}%`;
            
            // æ›´æ–°å½“å‰æ­¥éª¤
            if (currentStepIndex < steps.length) {
                const step = steps[currentStepIndex];
                const currentStep = document.getElementById('currentStep');
                currentStep.innerHTML = `
                    <div class="step-icon">${step.icon}</div>
                    <div class="step-info">
                        <div class="step-title">${step.title}</div>
                        <div class="step-detail">${step.detail}</div>
                    </div>
                `;
            }
            
            // æ›´æ–°è¯¦ç»†è¿›åº¦
            const progressItems = document.querySelectorAll('.progress-item');
            progressItems.forEach((item, index) => {
                const status = item.querySelector('.progress-status');
                if (index < currentStepIndex) {
                    item.className = 'progress-item completed';
                    status.className = 'progress-status completed';
                    status.textContent = 'å·²å®Œæˆ';
                } else if (index === currentStepIndex) {
                    item.className = 'progress-item active';
                    status.className = 'progress-status active';
                    status.textContent = 'è¿›è¡Œä¸­';
                } else {
                    item.className = 'progress-item';
                    status.className = 'progress-status waiting';
                    status.textContent = 'ç­‰å¾…ä¸­';
                }
            });
        }
        
        function addLogMessage(message, type = 'info') {
            const logContainer = document.getElementById('detailLog');
            if (!logContainer) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = document.createElement('div');
            logMessage.style.marginBottom = '8px';
            logMessage.style.padding = '8px 12px';
            logMessage.style.borderRadius = '4px';
            logMessage.style.borderLeft = '3px solid';
            
            // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
            if (type === 'step') {
                logMessage.style.background = '#e3f2fd';
                logMessage.style.borderLeftColor = '#2196f3';
                logMessage.style.fontWeight = '600';
                logMessage.style.color = '#1976d2';
            } else if (type === 'rename') {
                logMessage.style.background = '#fff3e0';
                logMessage.style.borderLeftColor = '#ff9800';
                logMessage.style.color = '#e65100';
            } else if (type === 'move') {
                logMessage.style.background = '#e8f5e9';
                logMessage.style.borderLeftColor = '#4caf50';
                logMessage.style.color = '#2e7d32';
            } else if (type === 'error') {
                logMessage.style.background = '#ffebee';
                logMessage.style.borderLeftColor = '#f44336';
                logMessage.style.color = '#c62828';
            } else if (type === 'success') {
                logMessage.style.background = '#e8f5e9';
                logMessage.style.borderLeftColor = '#4caf50';
                logMessage.style.color = '#2e7d32';
                logMessage.style.fontWeight = '600';
            } else {
                logMessage.style.background = '#f5f5f5';
                logMessage.style.borderLeftColor = '#9e9e9e';
                logMessage.style.color = '#424242';
            }
            
            logMessage.innerHTML = `<span style="color: #999; font-size: 11px;">[${timestamp}]</span> ${message}`;
            
            logContainer.appendChild(logMessage);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ¡æ•°ï¼ˆæœ€å¤š500æ¡ï¼‰
            const messages = logContainer.children;
            if (messages.length > 500) {
                logContainer.removeChild(messages[0]);
            }
        }
        
        // æ·»åŠ é‡å‘½åæ—¥å¿—ï¼ˆç‰¹æ®Šæ ¼å¼ï¼‰
        function addRenameLog(oldName, newName) {
            const message = `${oldName} <span style="color: #ff9800; font-weight: bold;">=========></span> ${newName}`;
            addLogMessage(message, 'rename');
        }
        
        // æ·»åŠ ç§»åŠ¨æ—¥å¿—
        function addMoveLog(fileName, targetPath) {
            const message = `ğŸ“¦ ç§»åŠ¨æ–‡ä»¶: ${fileName}<br><span style="margin-left: 20px; color: #666;">â†’ ${targetPath}</span>`;
            addLogMessage(message, 'move');
        }
        
        function nextStep(stepName) {
            if (stepName) {
                addLogMessage(`âœ… ${stepName} å®Œæˆ`, 'success');
            }
            currentStepIndex++;
            updateProgressDisplay();
        }
        
        // æ›´æ–°å½“å‰æ­¥éª¤æ˜¾ç¤º
        function updateCurrentStepDisplay(stepName, detail = '') {
            const currentStepEl = document.getElementById('currentStep');
            if (!currentStepEl) return;
            
            const stepIcons = {
                'æ™ºèƒ½æ‰«æ': 'ğŸ“‚',
                'ä¸­æ–‡æ ‡é¢˜è¯†åˆ«': 'ğŸŒ',
                'æ™ºèƒ½å»é‡': 'ğŸ¯',
                'æ ‡å‡†åŒ–é‡å‘½å': 'ğŸ“',
                'æ™ºèƒ½åˆ†ç±»': 'ğŸ“',
                'è‡ªåŠ¨ç§»åŠ¨': 'ğŸšš',
                'å†²çªå¤„ç†': 'âš”ï¸',
                'è‡ªåŠ¨æ¸…ç†': 'ğŸ§¹'
            };
            
            const icon = stepIcons[stepName] || 'âš¡';
            
            currentStepEl.innerHTML = `
                <div class="step-icon">${icon}</div>
                <div class="step-info">
                    <div class="step-title">${stepName}</div>
                    <div class="step-detail">${detail || 'å¤„ç†ä¸­...'}</div>
                </div>
            `;
        }
        
        function completeProcessing() {
            isProcessing = false;
            currentStepIndex = steps.length;
            
            // æ›´æ–°ä¸ºå®ŒæˆçŠ¶æ€
            document.getElementById('overallProgress').style.width = '100%';
            document.getElementById('overallStatus').textContent = 'å¤„ç†å®Œæˆï¼';
            
            const currentStep = document.getElementById('currentStep');
            currentStep.innerHTML = `
                <div class="step-icon">âœ…</div>
                <div class="step-info">
                    <div class="step-title">å¤„ç†å®Œæˆ</div>
                    <div class="step-detail">æ‰€æœ‰æ–‡ä»¶å·²æˆåŠŸæ•´ç†å…¥åº“</div>
                </div>
            `;
            
            // æ‰€æœ‰æ­¥éª¤æ ‡è®°ä¸ºå®Œæˆ
            const progressItems = document.querySelectorAll('.progress-item');
            progressItems.forEach(item => {
                item.className = 'progress-item completed';
                const status = item.querySelector('.progress-status');
                status.className = 'progress-status completed';
                status.textContent = 'å·²å®Œæˆ';
            });
            
            addLogMessage('ğŸ‰ æ•´ç†å®Œæˆï¼æ‰€æœ‰æ–‡ä»¶å·²æˆåŠŸå…¥åº“');
            
            // æ˜¾ç¤ºå®Œæˆé€šçŸ¥
            if (!progressModal || progressModal.style.display === 'none') {
                showCompletionNotification();
            }
        }
        
        function showCompletionNotification() {
            // åˆ›å»ºå®Œæˆé€šçŸ¥
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                color: white;
                padding: 20px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3);
                z-index: 1001;
                animation: slideInRight 0.5s ease-out;
                cursor: pointer;
                max-width: 300px;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                    <span style="font-size: 24px;">ğŸ‰</span>
                    <strong>æ•´ç†å®Œæˆï¼</strong>
                </div>
                <div style="font-size: 14px; opacity: 0.9;">æ‰€æœ‰æ–‡ä»¶å·²æˆåŠŸæ•´ç†å…¥åº“</div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 8px;">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</div>
            `;
            
            // æ·»åŠ æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        opacity: 0;
                        transform: translateX(100%);
                    }
                    to {
                        opacity: 1;
                        transform: translateX(0);
                    }
                }
            `;
            document.head.appendChild(style);
            
            notification.onclick = () => {
                showProgressModal();
                document.body.removeChild(notification);
            };
            
            document.body.appendChild(notification);
            
            // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.style.animation = 'slideInRight 0.5s ease-out reverse';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 500);
                }
            }, 5000);
        }
        
        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        document.addEventListener('click', function(e) {
            if (e.target.id === 'progressModal') {
                closeProgressModal();
            }
        });
        
        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && progressModal && progressModal.style.display === 'flex') {
                closeProgressModal();
            }
        });

        async function startAutoRename() {
            // å¼€å§‹å¤„ç†
            isProcessing = true;
            currentStepIndex = 0;
            
            // å¦‚æœå¼¹çª—å·²æ‰“å¼€ï¼Œæ›´æ–°æ˜¾ç¤º
            if (progressModal && progressModal.style.display === 'flex') {
                updateProgressDisplay();
            }
            
            addLogMessage('ğŸš€ å¼€å§‹æ•´ç†å…¥åº“æµç¨‹');
            
            // è·å–å¹¶ä¿å­˜è·¯å¾„
            const folderPath = document.getElementById('folderPath').value.trim();
            
            if (!folderPath) {
                addLogMessage('âŒ é”™è¯¯ï¼šæœªè¾“å…¥æ‰«æè·¯å¾„');
                showStatus('è¯·è¾“å…¥æ‰«æè·¯å¾„', 'error');
                isProcessing = false;
                return;
            }
            
            // ä¿å­˜è·¯å¾„åˆ°localStorage
            localStorage.setItem('scanPath', folderPath);
            currentFolder = folderPath;
            
            // æ­¥éª¤1: æ™ºèƒ½æ‰«æ
            addLogMessage('ğŸ“‚ å¼€å§‹æ‰«æå¾…æ•´ç†ç›®å½•...');
            showStatus('æ­£åœ¨æ‰«æç½‘ç›˜æ–‡ä»¶ï¼ˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰...', 'info');
            const autoDelete = true;  // å›ºå®šå¼€å¯
            const recursive = true;   // å›ºå®šå¼€å¯

            try {
                const response = await fetch('/api/scan-all', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        folderPath,
                        autoDelete,
                        recursive
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error);
                }

                currentFiles = data.supported;
                currentFolder = data.folderPath;
                
                const supportedCount = data.supported.length;
                const deletedCount = data.deleted.length;
                
                if (supportedCount === 0) {
                    addLogMessage('âš ï¸ æ²¡æœ‰æ‰¾åˆ°æ”¯æŒçš„åª’ä½“æˆ–å­—å¹•æ–‡ä»¶');
                    showStatus('æ²¡æœ‰æ‰¾åˆ°æ”¯æŒçš„åª’ä½“æˆ–å­—å¹•æ–‡ä»¶', 'error');
                    isProcessing = false;
                    return;
                }
                
                let statusMsg = `æ‰«æå®Œæˆï¼šæ‰¾åˆ° ${supportedCount} ä¸ªæ–‡ä»¶`;
                if (deletedCount > 0) {
                    statusMsg += `ï¼Œå·²åˆ é™¤ ${deletedCount} ä¸ªä¸æ”¯æŒçš„æ–‡ä»¶`;
                    addLogMessage(`ğŸ—‘ï¸ åˆ é™¤äº† ${deletedCount} ä¸ªä¸æ”¯æŒçš„æ–‡ä»¶`);
                }
                addLogMessage(`âœ“ æ‰«æå®Œæˆï¼Œæ‰¾åˆ° ${supportedCount} ä¸ªåª’ä½“æ–‡ä»¶`);
                showStatus(statusMsg, 'success');
                
                nextStep('æ™ºèƒ½æ‰«æ');
                
                // å»¶è¿Ÿ1ç§’åè‡ªåŠ¨å¼€å§‹æ™ºèƒ½é‡å‘½å
                await delay(1000);
                smartRename();
                
            } catch (error) {
                addLogMessage(`âŒ æ‰«æå‡ºé”™: ${error.message}`);
                showStatus('é”™è¯¯: ' + error.message, 'error');
                isProcessing = false;
            }
        }

        async function smartRename() {
            // æ­¥éª¤2: ä¸­æ–‡æ ‡é¢˜è¯†åˆ« (åœ¨APIå†…éƒ¨å®Œæˆ)
            addLogMessage('ğŸŒ å¼€å§‹ä¸­æ–‡æ ‡é¢˜è¯†åˆ«...');
            nextStep('ä¸­æ–‡æ ‡é¢˜è¯†åˆ«');
            
            const filtered = currentFiles;

            if (filtered.length === 0) {
                addLogMessage('âš ï¸ æ²¡æœ‰æ–‡ä»¶å¯ä»¥é‡å‘½å');
                showStatus('æ²¡æœ‰æ–‡ä»¶å¯ä»¥é‡å‘½å', 'error');
                isProcessing = false;
                return;
            }

            const autoDedupe = true;  // å›ºå®šå¼€å¯

            addLogMessage('ğŸ¯ å¼€å§‹æ™ºèƒ½å»é‡...');
            showStatus('æ­£åœ¨åˆ†ææ–‡ä»¶åå¹¶æ£€æµ‹é‡å¤ç‰ˆæœ¬...', 'info');

            try {
                // è·å–è¾“å‡ºè·¯å¾„ï¼ˆæ”¯æŒæ–°æ—§é…ç½®ï¼‰
                const mediaLibraryPath = document.getElementById('mediaLibraryPath').value.trim();
                const movieOutputPath = document.getElementById('movieOutputPath').value.trim();
                const tvOutputPath = document.getElementById('tvOutputPath').value.trim();
                const language = document.getElementById('preferredLanguage') ? 
                    document.getElementById('preferredLanguage').value : 'zh';
                
                // éªŒè¯è·¯å¾„é…ç½®
                if (!mediaLibraryPath && (!movieOutputPath || !tvOutputPath)) {
                    throw new Error('è¯·å…ˆé…ç½®åª’ä½“åº“è·¯å¾„ï¼\n\nåœ¨"è¾“å‡ºé…ç½®"åŒºåŸŸå¡«å†™åª’ä½“åº“æ ¹è·¯å¾„ï¼Œä¾‹å¦‚ï¼š/vol02/1000-1-b23abde7/115');
                }
                
                // è°ƒç”¨æ™ºèƒ½é‡å‘½åAPI
                const response = await fetch('/api/smart-rename', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        files: filtered,
                        basePath: currentFolder,
                        mediaLibraryPath: mediaLibraryPath,
                        language: language,
                        movieOutputPath: movieOutputPath,
                        tvOutputPath: tvOutputPath,
                        autoDedupe
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error);
                }

                addLogMessage(`âœ“ å»é‡å®Œæˆï¼Œå°†åˆ é™¤ ${data.toDelete.length} ä¸ªä½è´¨é‡æ–‡ä»¶`);
                addLogMessage(`âœ“ å°†å¤„ç† ${data.results.length} ä¸ªæ–‡ä»¶`);
                
                // æ­¥éª¤3: æ™ºèƒ½å»é‡å®Œæˆ
                updateCurrentStepDisplay('æ™ºèƒ½å»é‡', `è¯†åˆ«åˆ° ${data.toDelete ? data.toDelete.length : 0} ä¸ªé‡å¤æ–‡ä»¶`);
                addLogMessage(`ğŸ¯ æ™ºèƒ½å»é‡å®Œæˆï¼Œè¯†åˆ«åˆ° ${data.toDelete ? data.toDelete.length : 0} ä¸ªé‡å¤æ–‡ä»¶`, 'step');
                if (data.toDelete && data.toDelete.length > 0) {
                    data.toDelete.forEach(d => {
                        addLogMessage(`ğŸ—‘ï¸ æ ‡è®°åˆ é™¤: ${d.name} (${d.reason})`, 'info');
                    });
                }
                nextStep('æ™ºèƒ½å»é‡');
                
                // æ­¥éª¤4: æ ‡å‡†åŒ–é‡å‘½å
                updateCurrentStepDisplay('æ ‡å‡†åŒ–é‡å‘½å', `å‡†å¤‡é‡å‘½å ${data.results.length} ä¸ªæ–‡ä»¶`);
                addLogMessage(`ğŸ“ æ ‡å‡†åŒ–é‡å‘½åå®Œæˆï¼Œç”Ÿæˆ ${data.results.length} ä¸ªæ–°æ–‡ä»¶å`, 'step');
                nextStep('æ ‡å‡†åŒ–é‡å‘½å');
                
                // æ­¥éª¤5: æ™ºèƒ½åˆ†ç±»
                updateCurrentStepDisplay('æ™ºèƒ½åˆ†ç±»', 'æ ¹æ®å…ƒæ•°æ®ç¡®å®šåˆ†ç±»ç›®å½•');
                addLogMessage(`ğŸ“ æ™ºèƒ½åˆ†ç±»å®Œæˆ`, 'step');
                nextStep('æ™ºèƒ½åˆ†ç±»');
                
                // æ˜¾ç¤ºé¢„è§ˆ
                showRenamePreview(data.results, data.toDelete);
            } catch (error) {
                addLogMessage(`âŒ å¤„ç†å‡ºé”™: ${error.message}`);
                showStatus('é”™è¯¯: ' + error.message, 'error');
                isProcessing = false;
            }
        }

        function showRenamePreview(results, toDelete = []) {
            let message = '';
            
            if (toDelete.length > 0) {
                message += `ã€å°†åˆ é™¤ ${toDelete.length} ä¸ªä½æ¸…æ™°åº¦ç‰ˆæœ¬ã€‘\n`;
                toDelete.forEach(d => {
                    message += `âŒ ${d.name}\n   åŸå› : ${d.reason}\n`;
                });
                message += '\n';
            }
            
            message += `ã€å°†é‡å‘½åå¹¶åˆ†ç±» ${results.length} ä¸ªæ–‡ä»¶ã€‘\n`;
            const preview = results.map(r => {
                let line = `âœ“ ${r.oldName}\n  â†’ ${r.newName}`;
                if (r.category) {
                    line += `\n  ğŸ“ åˆ†ç±»: ${r.category}`;
                }
                return line;
            }).join('\n');
            
            message += preview.substring(0, 1000);
            if (preview.length > 1000) {
                message += '\n...';
            }
            
            message += '\n\nç¡®å®šç»§ç»­ï¼Ÿ';

            const confirmed = confirm(message);

            if (!confirmed) return;

            executeSmartRename(results, toDelete);
        }

        // å»¶è¿Ÿå‡½æ•°ï¼Œç”¨äºç½‘ç›˜æ“ä½œé—´éš”
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function executeSmartRename(results, toDelete = []) {
            // æ­¥éª¤6: è‡ªåŠ¨ç§»åŠ¨
            addLogMessage('ğŸšš å¼€å§‹è‡ªåŠ¨ç§»åŠ¨æ–‡ä»¶...');
            nextStep('è‡ªåŠ¨ç§»åŠ¨');
            
            let totalTasks = results.length + toDelete.length;
            showStatus(`æ­£åœ¨å¤„ç† ${totalTasks} ä¸ªæ–‡ä»¶ï¼ˆç½‘ç›˜æ“ä½œè¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼‰...`, 'info');

            let renameSuccess = 0;
            let renameFailed = 0;
            let deleteSuccess = 0;
            let deleteFailed = 0;
            let skippedFiles = [];  // è®°å½•è·³è¿‡çš„æ–‡ä»¶è·¯å¾„
            renameLog = [];

            // å…ˆåˆ é™¤ä½æ¸…æ™°åº¦ç‰ˆæœ¬ï¼ˆé€ä¸ªå¤„ç†ï¼Œé¿å…ç½‘ç›˜å‹åŠ›ï¼‰
            if (toDelete.length > 0) {
                updateCurrentStepDisplay('æ™ºèƒ½å»é‡', `æ­£åœ¨åˆ é™¤ ${toDelete.length} ä¸ªé‡å¤æ–‡ä»¶`);
                addLogMessage(`ğŸ—‘ï¸ å¼€å§‹åˆ é™¤ ${toDelete.length} ä¸ªé‡å¤æ–‡ä»¶`, 'step');
            }
            
            for (let i = 0; i < toDelete.length; i++) {
                const item = toDelete[i];
                showStatus(`æ­£åœ¨åˆ é™¤ (${i + 1}/${toDelete.length}): ${item.name}`, 'info');
                
                try {
                    const response = await fetch('/api/delete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ filePath: item.path })
                    });

                    if (response.ok) {
                        deleteSuccess++;
                        addLogMessage(`ğŸ—‘ï¸ åˆ é™¤é‡å¤æ–‡ä»¶: ${item.name}`, 'info');
                        renameLog.push({
                            type: 'delete',
                            name: item.name,
                            reason: item.reason
                        });
                    } else {
                        deleteFailed++;
                        addLogMessage(`âŒ åˆ é™¤å¤±è´¥: ${item.name}`, 'error');
                        renameLog.push({
                            type: 'error',
                            name: item.name,
                            reason: 'åˆ é™¤å¤±è´¥'
                        });
                    }
                } catch (error) {
                    deleteFailed++;
                    addLogMessage(`âŒ åˆ é™¤å¤±è´¥: ${item.name} - ${error.message}`, 'error');
                    renameLog.push({
                        type: 'error',
                        name: item.name,
                        reason: 'åˆ é™¤å¤±è´¥: ' + error.message
                    });
                }
                
                // ç½‘ç›˜æ“ä½œé—´éš”ï¼Œé¿å…è¿‡å¿«æ“ä½œ
                if (i < toDelete.length - 1) {
                    await delay(300);
                }
            }

            // å†é‡å‘½åä¿ç•™çš„æ–‡ä»¶ï¼ˆé€ä¸ªå¤„ç†ï¼‰
            if (results.length > 0) {
                updateCurrentStepDisplay('è‡ªåŠ¨ç§»åŠ¨', `æ­£åœ¨å¤„ç† ${results.length} ä¸ªæ–‡ä»¶`);
                addLogMessage(`ğŸšš å¼€å§‹é‡å‘½åå’Œç§»åŠ¨ ${results.length} ä¸ªæ–‡ä»¶`, 'step');
            }
            
            for (let i = 0; i < results.length; i++) {
                const result = results[i];
                const statusMsg = result.category ? 
                    `æ­£åœ¨å¤„ç† (${i + 1}/${results.length}): ${result.oldName} â†’ ${result.category}` :
                    `æ­£åœ¨é‡å‘½å (${i + 1}/${results.length}): ${result.oldName}`;
                showStatus(statusMsg, 'info');
                
                try {
                    // è·å–å†²çªå¤„ç†ç­–ç•¥
                    const conflictStrategy = document.getElementById('conflictStrategy').value;
                    
                    const response = await fetch('/api/rename', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            oldPath: result.oldPath, 
                            newPath: result.newPath,  // ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼ˆæ”¯æŒç§»åŠ¨+é‡å‘½åï¼‰
                            conflictStrategy: conflictStrategy  // ä¼ é€’å†²çªç­–ç•¥
                        })
                    });

                    const responseData = await response.json();

                    if (response.ok) {
                        if (responseData.skipped) {
                            // æ–‡ä»¶è¢«è·³è¿‡ï¼Œè®°å½•è·¯å¾„ç”¨äºåç»­æ¸…ç†
                            skippedFiles.push(result.oldPath);
                            addLogMessage(`âŠ˜ è·³è¿‡æ–‡ä»¶: ${result.oldName} (${responseData.reason})`, 'info');
                            renameLog.push({
                                type: 'skip',
                                oldName: result.oldName,
                                newName: result.newName,
                                reason: responseData.reason,
                                category: result.category
                            });
                        } else {
                            // æˆåŠŸå¤„ç†
                            renameSuccess++;
                            // æ·»åŠ é‡å‘½åæ—¥å¿—
                            addRenameLog(result.oldName, result.newName);
                            // æ·»åŠ ç§»åŠ¨æ—¥å¿—
                            if (result.category) {
                                addMoveLog(result.newName, result.newPath);
                            }
                            renameLog.push({
                                type: 'rename',
                                oldName: result.oldName,
                                newName: result.newName,
                                category: result.category
                            });
                        }
                    } else {
                        renameFailed++;
                        addLogMessage(`âŒ å¤„ç†å¤±è´¥: ${result.oldName} - ${responseData.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                        renameLog.push({
                            type: 'error',
                            name: result.oldName,
                            reason: responseData.error || 'å¤„ç†å¤±è´¥'
                        });
                    }
                } catch (error) {
                    renameFailed++;
                    addLogMessage(`âŒ å¤„ç†å¤±è´¥: ${result.oldName} - ${error.message}`, 'error');
                    renameLog.push({
                        type: 'error',
                        name: result.oldName,
                        reason: 'é‡å‘½åå¤±è´¥: ' + error.message
                    });
                }
                
                // ç½‘ç›˜æ“ä½œé—´éš”
                if (i < results.length - 1) {
                    await delay(300);
                }
            }

            // æ¸…ç†è·³è¿‡çš„æ–‡ä»¶å’Œç©ºæ–‡ä»¶å¤¹
            let cleanupSuccess = 0;
            let cleanupFolders = 0;
            
            if (skippedFiles.length > 0) {
                showStatus(`æ­£åœ¨æ¸…ç† ${skippedFiles.length} ä¸ªè·³è¿‡çš„æ–‡ä»¶...`, 'info');
                
                try {
                    const cleanupResponse = await fetch('/api/cleanup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            skippedFiles: skippedFiles,
                            basePath: currentFolder
                        })
                    });
                    
                    if (cleanupResponse.ok) {
                        const cleanupData = await cleanupResponse.json();
                        cleanupSuccess = cleanupData.deletedFiles.length;
                        cleanupFolders = cleanupData.deletedFolders.length;
                        
                        // æ·»åŠ æ¸…ç†æ—¥å¿—
                        cleanupData.deletedFiles.forEach(file => {
                            renameLog.push({
                                type: 'cleanup',
                                name: file,
                                reason: 'è´¨é‡ç›¸åŒæˆ–è¾ƒå·®ï¼Œå·²æ¸…ç†'
                            });
                        });
                        
                        cleanupData.deletedFolders.forEach(folder => {
                            renameLog.push({
                                type: 'cleanup_folder',
                                name: folder,
                                reason: 'ç©ºæ–‡ä»¶å¤¹ï¼Œå·²æ¸…ç†'
                            });
                        });
                    }
                } catch (error) {
                    console.error('æ¸…ç†å¤±è´¥:', error);
                }
            }

            // æ­¥éª¤7: å†²çªå¤„ç† (åœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­å®Œæˆ)
            nextStep('å†²çªå¤„ç†');
            
            // æ­¥éª¤8: è‡ªåŠ¨æ¸…ç†
            addLogMessage('ğŸ§¹ å¼€å§‹è‡ªåŠ¨æ¸…ç†...');
            nextStep('è‡ªåŠ¨æ¸…ç†');
            
            let statusMsg = `å¤„ç†å®Œæˆï¼š`;
            if (deleteSuccess > 0) {
                statusMsg += `åˆ é™¤ ${deleteSuccess} ä¸ªä½æ¸…æ™°åº¦ç‰ˆæœ¬ï¼Œ`;
                addLogMessage(`âœ“ åˆ é™¤äº† ${deleteSuccess} ä¸ªä½æ¸…æ™°åº¦ç‰ˆæœ¬`);
            }
            statusMsg += `é‡å‘½å ${renameSuccess} ä¸ªæ–‡ä»¶`;
            addLogMessage(`âœ“ æˆåŠŸå¤„ç† ${renameSuccess} ä¸ªæ–‡ä»¶`);
            
            if (cleanupSuccess > 0) {
                statusMsg += `ï¼Œæ¸…ç† ${cleanupSuccess} ä¸ªè·³è¿‡çš„æ–‡ä»¶`;
                addLogMessage(`âœ“ æ¸…ç†äº† ${cleanupSuccess} ä¸ªè·³è¿‡çš„æ–‡ä»¶`);
            }
            if (cleanupFolders > 0) {
                statusMsg += `ï¼Œæ¸…ç† ${cleanupFolders} ä¸ªç©ºæ–‡ä»¶å¤¹`;
                addLogMessage(`âœ“ æ¸…ç†äº† ${cleanupFolders} ä¸ªç©ºæ–‡ä»¶å¤¹`);
            }
            
            if (deleteFailed > 0 || renameFailed > 0) {
                statusMsg += `ï¼ˆ${deleteFailed + renameFailed} ä¸ªå¤±è´¥ï¼‰`;
                addLogMessage(`âš ï¸ ${deleteFailed + renameFailed} ä¸ªæ–‡ä»¶å¤„ç†å¤±è´¥`);
            }

            showStatus(statusMsg, (renameSuccess > 0 || deleteSuccess > 0 || cleanupSuccess > 0) ? 'success' : 'error');
            
            // å®Œæˆå¤„ç†
            completeProcessing();
            
            scanFolder();
        }


        // æ–‡ä»¶å¤¹æµè§ˆå™¨
        let currentBrowsePath = '/';
        let currentBrowserType = 'scan'; // 'scan', 'movie', 'tv', 'media'

        async function openFolderBrowser(type = 'scan') {
            currentBrowserType = type;
            const overlay = document.getElementById('folderBrowserOverlay');
            overlay.classList.add('show');
            
            // æ ¹æ®ç±»å‹ä»å¯¹åº”çš„è¾“å…¥æ¡†è·å–å½“å‰è·¯å¾„ä½œä¸ºèµ·å§‹è·¯å¾„
            let inputId = 'folderPath';
            if (type === 'movie') {
                inputId = 'movieOutputPath';
            } else if (type === 'tv') {
                inputId = 'tvOutputPath';
            } else if (type === 'media') {
                inputId = 'mediaLibraryPath';
            }
            
            const currentPath = document.getElementById(inputId).value.trim();
            if (currentPath && currentPath !== '') {
                currentBrowsePath = currentPath;
            } else {
                currentBrowsePath = '/';
            }
            
            await loadFolders(currentBrowsePath);
        }

        function closeFolderBrowser(event) {
            if (event && event.target !== event.currentTarget) return;
            const overlay = document.getElementById('folderBrowserOverlay');
            overlay.classList.remove('show');
        }

        async function loadFolders(path) {
            const folderList = document.getElementById('folderList');
            const pathDisplay = document.getElementById('currentBrowserPath');
            
            folderList.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">åŠ è½½ä¸­...</div>';
            pathDisplay.textContent = path;
            currentBrowsePath = path;
            
            try {
                const response = await fetch('/api/browse-folders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ folderPath: path })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error);
                }

                let html = '';
                
                // æ·»åŠ è¿”å›ä¸Šçº§ç›®å½•
                if (data.parentPath) {
                    html += `
                        <div class="folder-item" onclick="loadFolders('${data.parentPath.replace(/'/g, "\\'")}')">
                            <span class="folder-item-icon">â¬†ï¸</span>
                            <span class="folder-item-name">..</span>
                        </div>
                    `;
                }
                
                // æ·»åŠ å­æ–‡ä»¶å¤¹
                if (data.folders.length === 0 && !data.parentPath) {
                    html = '<div style="text-align: center; padding: 40px; color: #999;">æ­¤æ–‡ä»¶å¤¹ä¸ºç©º</div>';
                } else if (data.folders.length === 0) {
                    // æœ‰çˆ¶ç›®å½•ä½†æ²¡æœ‰å­æ–‡ä»¶å¤¹
                } else {
                    data.folders.forEach(folder => {
                        const safePath = folder.path.replace(/'/g, "\\'");
                        const accessible = folder.accessible !== false; // é»˜è®¤ä¸ºå¯è®¿é—®
                        const icon = accessible ? 'ğŸ“' : 'ğŸ”’';
                        const style = accessible ? '' : 'opacity: 0.5; cursor: not-allowed;';
                        const title = accessible ? '' : 'title="æ— æƒé™è®¿é—®"';
                        const onclick = accessible ? `onclick="loadFolders('${safePath}')"` : '';
                        
                        html += `
                            <div class="folder-item" ${onclick} style="${style}" ${title}>
                                <span class="folder-item-icon">${icon}</span>
                                <span class="folder-item-name">${escapeHtml(folder.name)}</span>
                            </div>
                        `;
                    });
                }
                
                folderList.innerHTML = html;
            } catch (error) {
                folderList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #f44336;">
                        âŒ åŠ è½½å¤±è´¥<br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        function selectCurrentFolder() {
            // æ ¹æ®æµè§ˆå™¨ç±»å‹è®¾ç½®å¯¹åº”çš„è¾“å…¥æ¡†
            if (currentBrowserType === 'scan') {
                document.getElementById('folderPath').value = currentBrowsePath;
                localStorage.setItem('scanPath', currentBrowsePath);
                currentFolder = currentBrowsePath;
            } else if (currentBrowserType === 'movie') {
                document.getElementById('movieOutputPath').value = currentBrowsePath;
                localStorage.setItem('movieOutputPath', currentBrowsePath);
            } else if (currentBrowserType === 'tv') {
                document.getElementById('tvOutputPath').value = currentBrowsePath;
                localStorage.setItem('tvOutputPath', currentBrowsePath);
            } else if (currentBrowserType === 'media') {
                document.getElementById('mediaLibraryPath').value = currentBrowsePath;
                localStorage.setItem('mediaLibraryPath', currentBrowsePath);
            }
            closeFolderBrowser();
        }

        // æ£€æµ‹åª’ä½“åº“ç»“æ„
        async function detectMediaLibraryStructure() {
            const mediaLibraryPath = document.getElementById('mediaLibraryPath').value.trim();
            
            if (!mediaLibraryPath) {
                alert('è¯·å…ˆè¾“å…¥åª’ä½“åº“è·¯å¾„');
                return;
            }
            
            try {
                const response = await fetch('/api/detect-media-library', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ path: mediaLibraryPath })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const infoDiv = document.getElementById('mediaLibraryInfo');
                    const structureDiv = document.getElementById('detectedStructure');
                    
                    let html = '<strong>âœ“ æ£€æµ‹æˆåŠŸï¼š</strong><br>';
                    if (data.movie_dir) {
                        html += `ğŸ“ ç”µå½±ç›®å½•: ${data.movie_dir}<br>`;
                    }
                    if (data.tv_dir) {
                        html += `ğŸ“ ç”µè§†å‰§ç›®å½•: ${data.tv_dir}<br>`;
                    }
                    if (data.movie_categories && data.movie_categories.length > 0) {
                        html += `ğŸ¬ ç”µå½±åˆ†ç±»: ${data.movie_categories.join(', ')}<br>`;
                    }
                    if (data.tv_categories && data.tv_categories.length > 0) {
                        html += `ğŸ“º ç”µè§†å‰§åˆ†ç±»: ${data.tv_categories.join(', ')}`;
                    }
                    
                    structureDiv.innerHTML = html;
                    infoDiv.style.display = 'block';
                } else {
                    alert('æ£€æµ‹å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                alert('æ£€æµ‹å¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºæ–°é…ç½®ç•Œé¢
        function showNewConfig() {
            document.getElementById('legacyConfig').style.display = 'none';
            const mediaLibraryGroup = document.getElementById('mediaLibraryPath').parentElement.parentElement;
            if (mediaLibraryGroup) {
                mediaLibraryGroup.style.display = 'block';
            }
            const languageGroup = document.getElementById('preferredLanguage').parentElement;
            if (languageGroup) {
                languageGroup.style.display = 'block';
            }
        }

        // æ£€æµ‹é…ç½®è¿ç§»
        function checkConfigMigration() {
            // æ£€æŸ¥æ˜¯å¦å·²ç»è¿ç§»è¿‡æˆ–ç”¨æˆ·é€‰æ‹©è·³è¿‡
            const migrationSkipped = localStorage.getItem('configMigrationSkipped');
            if (migrationSkipped === 'true') {
                return;
            }

            // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ—§é…ç½®
            const mediaLibraryPath = localStorage.getItem('mediaLibraryPath');
            const movieOutputPath = localStorage.getItem('movieOutputPath');
            const tvOutputPath = localStorage.getItem('tvOutputPath');

            // å¦‚æœå·²æœ‰æ–°é…ç½®ï¼Œä¸æç¤º
            if (mediaLibraryPath && mediaLibraryPath !== '') {
                return;
            }

            // å¦‚æœæœ‰æ—§é…ç½®ï¼Œæ˜¾ç¤ºè¿ç§»æç¤º
            if ((movieOutputPath && movieOutputPath !== '') || (tvOutputPath && tvOutputPath !== '')) {
                showConfigMigrationDialog(movieOutputPath, tvOutputPath);
            }
        }

        // æ˜¾ç¤ºé…ç½®è¿ç§»å¯¹è¯æ¡†
        function showConfigMigrationDialog(moviePath, tvPath) {
            const overlay = document.getElementById('configMigrationOverlay');
            const oldConfigDisplay = document.getElementById('oldConfigDisplay');

            let html = '';
            if (moviePath) {
                html += `ğŸ¬ ç”µå½±è·¯å¾„: ${moviePath}<br>`;
            }
            if (tvPath) {
                html += `ğŸ“º ç”µè§†å‰§è·¯å¾„: ${tvPath}`;
            }

            oldConfigDisplay.innerHTML = html;
            overlay.style.display = 'flex';
        }

        // å…³é—­é…ç½®è¿ç§»å¯¹è¯æ¡†
        function closeConfigMigration() {
            const overlay = document.getElementById('configMigrationOverlay');
            overlay.style.display = 'none';
        }

        // è·³è¿‡è¿ç§»
        function skipMigration() {
            localStorage.setItem('configMigrationSkipped', 'true');
            closeConfigMigration();
        }

        // å¼€å§‹è¿ç§»
        function startMigration() {
            const movieOutputPath = localStorage.getItem('movieOutputPath');
            const tvOutputPath = localStorage.getItem('tvOutputPath');

            // å°è¯•ä»æ—§è·¯å¾„æ¨æ–­åª’ä½“åº“æ ¹è·¯å¾„
            let mediaLibraryPath = '';

            if (movieOutputPath && tvOutputPath) {
                // å°è¯•æ‰¾åˆ°å…±åŒçš„çˆ¶è·¯å¾„
                const movieParts = movieOutputPath.split('/').filter(p => p);
                const tvParts = tvOutputPath.split('/').filter(p => p);

                // æ‰¾åˆ°å…±åŒçš„å‰ç¼€
                let commonPath = [];
                for (let i = 0; i < Math.min(movieParts.length - 1, tvParts.length - 1); i++) {
                    if (movieParts[i] === tvParts[i]) {
                        commonPath.push(movieParts[i]);
                    } else {
                        break;
                    }
                }

                if (commonPath.length > 0) {
                    mediaLibraryPath = '/' + commonPath.join('/');
                }
            } else if (movieOutputPath) {
                // åªæœ‰ç”µå½±è·¯å¾„ï¼Œå–çˆ¶ç›®å½•
                const parts = movieOutputPath.split('/').filter(p => p);
                if (parts.length > 1) {
                    mediaLibraryPath = '/' + parts.slice(0, -1).join('/');
                }
            } else if (tvOutputPath) {
                // åªæœ‰ç”µè§†å‰§è·¯å¾„ï¼Œå–çˆ¶ç›®å½•
                const parts = tvOutputPath.split('/').filter(p => p);
                if (parts.length > 1) {
                    mediaLibraryPath = '/' + parts.slice(0, -1).join('/');
                }
            }

            // å¦‚æœæ¨æ–­å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„
            if (!mediaLibraryPath) {
                mediaLibraryPath = '/vol02/1000-1-b23abde7/115';
            }

            // ä¿å­˜æ–°é…ç½®
            localStorage.setItem('mediaLibraryPath', mediaLibraryPath);
            document.getElementById('mediaLibraryPath').value = mediaLibraryPath;

            // è®¾ç½®é»˜è®¤è¯­è¨€ä¸ºä¸­æ–‡
            localStorage.setItem('preferredLanguage', 'zh');
            const languageSelect = document.getElementById('preferredLanguage');
            if (languageSelect) {
                languageSelect.value = 'zh';
            }

            // å¤‡ä»½æ—§é…ç½®ï¼ˆä¿ç•™åœ¨ localStorage ä¸­ï¼Œä½†æ ‡è®°ä¸ºå·²è¿ç§»ï¼‰
            localStorage.setItem('configMigrated', 'true');
            localStorage.setItem('configMigrationSkipped', 'true');

            // å…³é—­å¯¹è¯æ¡†
            closeConfigMigration();

            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert(`âœ… é…ç½®å‡çº§æˆåŠŸï¼\n\næ–°åª’ä½“åº“è·¯å¾„: ${mediaLibraryPath}\n\næ—§é…ç½®å·²ä¿ç•™ä¸ºå¤‡ä»½ï¼Œæ‚¨å¯ä»¥åœ¨éœ€è¦æ—¶åˆ‡æ¢å›æ—§é…ç½®ã€‚`);

            // è‡ªåŠ¨æ£€æµ‹åª’ä½“åº“ç»“æ„
            detectMediaLibraryStructure();
        }

        // é¢„è§ˆè·¯å¾„é…ç½®
        async function previewPaths() {
            const previewSection = document.getElementById('pathPreviewSection');
            const previewContent = document.getElementById('pathPreviewContent');
            
            // è·å–é…ç½®
            const scanPath = document.getElementById('folderPath').value.trim();
            const mediaLibraryPath = document.getElementById('mediaLibraryPath').value.trim();
            const movieOutputPath = document.getElementById('movieOutputPath').value.trim();
            const tvOutputPath = document.getElementById('tvOutputPath').value.trim();
            const language = document.getElementById('preferredLanguage') ? 
                document.getElementById('preferredLanguage').value : 'zh';
            const conflictStrategy = document.getElementById('conflictStrategy').value;
            
            // æ£€æŸ¥é…ç½®
            if (!scanPath) {
                alert('è¯·å…ˆé…ç½®å¾…æ•´ç†è·¯å¾„');
                return;
            }
            
            let html = '';
            
            // æ˜¾ç¤ºå¾…æ•´ç†è·¯å¾„
            html += `<div style="margin-bottom: 10px;">`;
            html += `<strong>ğŸ“‚ å¾…æ•´ç†è·¯å¾„ï¼š</strong><br>`;
            html += `<span style="margin-left: 20px; color: #666;">${scanPath}</span>`;
            html += `</div>`;
            
            // åˆ¤æ–­ä½¿ç”¨æ–°é…ç½®è¿˜æ˜¯æ—§é…ç½®
            const useNewConfig = mediaLibraryPath && mediaLibraryPath !== '';
            
            if (useNewConfig) {
                // æ–°é…ç½®æ–¹å¼
                html += `<div style="margin-bottom: 10px;">`;
                html += `<strong>ğŸ“š åª’ä½“åº“è·¯å¾„ï¼š</strong><br>`;
                html += `<span style="margin-left: 20px; color: #666;">${mediaLibraryPath}</span>`;
                html += `</div>`;
                
                html += `<div style="margin-bottom: 10px;">`;
                html += `<strong>ğŸŒ è¯­è¨€åå¥½ï¼š</strong> ${language === 'zh' ? 'ä¸­æ–‡' : 'English'}`;
                html += `</div>`;
                
                // å°è¯•æ£€æµ‹åª’ä½“åº“ç»“æ„
                try {
                    const response = await fetch('/api/detect-media-library', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ path: mediaLibraryPath })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        html += `<div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #28a745;">`;
                        html += `<strong style="color: #28a745;">âœ“ æ£€æµ‹åˆ°çš„ç›®å½•ç»“æ„ï¼š</strong><br>`;
                        
                        if (data.movie_dir) {
                            html += `<span style="margin-left: 20px;">ğŸ“ ç”µå½±ç›®å½•: ${data.movie_dir}</span><br>`;
                            if (data.movie_categories && data.movie_categories.length > 0) {
                                html += `<span style="margin-left: 40px; font-size: 12px; color: #666;">åˆ†ç±»: ${data.movie_categories.join(', ')}</span><br>`;
                            }
                        }
                        
                        if (data.tv_dir) {
                            html += `<span style="margin-left: 20px;">ğŸ“ ç”µè§†å‰§ç›®å½•: ${data.tv_dir}</span><br>`;
                            if (data.tv_categories && data.tv_categories.length > 0) {
                                html += `<span style="margin-left: 40px; font-size: 12px; color: #666;">åˆ†ç±»: ${data.tv_categories.join(', ')}</span><br>`;
                            }
                        }
                        
                        html += `</div>`;
                        
                        // æ˜¾ç¤ºç¤ºä¾‹è·¯å¾„
                        html += `<div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px;">`;
                        html += `<strong>ğŸ“ æ–‡ä»¶å°†ä¿å­˜åˆ°ï¼š</strong><br>`;
                        html += `<span style="margin-left: 20px; font-size: 12px; color: #666;">ç”µå½±: ${mediaLibraryPath}/${data.movie_dir || (language === 'zh' ? 'ç”µå½±' : 'Movies')}/[åˆ†ç±»]/[ç”µå½±å]/[æ–‡ä»¶å]</span><br>`;
                        html += `<span style="margin-left: 20px; font-size: 12px; color: #666;">ç”µè§†å‰§: ${mediaLibraryPath}/${data.tv_dir || (language === 'zh' ? 'ç”µè§†å‰§' : 'TV Shows')}/[åˆ†ç±»]/[å‰§å]/Season X/[æ–‡ä»¶å]</span>`;
                        html += `</div>`;
                    } else {
                        html += `<div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">`;
                        html += `<strong style="color: #856404;">âš ï¸ æ— æ³•æ£€æµ‹åª’ä½“åº“ç»“æ„</strong><br>`;
                        html += `<span style="margin-left: 20px; font-size: 12px; color: #856404;">å°†ä½¿ç”¨é»˜è®¤ç›®å½•ç»“æ„</span>`;
                        html += `</div>`;
                    }
                } catch (error) {
                    html += `<div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">`;
                    html += `<strong style="color: #856404;">âš ï¸ æ£€æµ‹å¤±è´¥</strong><br>`;
                    html += `<span style="margin-left: 20px; font-size: 12px; color: #856404;">${error.message}</span>`;
                    html += `</div>`;
                }
            } else if (movieOutputPath || tvOutputPath) {
                // æ—§é…ç½®æ–¹å¼
                html += `<div style="margin-bottom: 10px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">`;
                html += `<strong style="color: #856404;">âš ï¸ ä½¿ç”¨æ—§é…ç½®æ¨¡å¼</strong><br>`;
                html += `<span style="margin-left: 20px; font-size: 12px; color: #856404;">å»ºè®®è¿ç§»åˆ°æ–°çš„åª’ä½“åº“è·¯å¾„é…ç½®</span>`;
                html += `</div>`;
                
                if (movieOutputPath) {
                    html += `<div style="margin-bottom: 10px;">`;
                    html += `<strong>ğŸ¬ ç”µå½±è¾“å‡ºè·¯å¾„ï¼š</strong><br>`;
                    html += `<span style="margin-left: 20px; color: #666;">${movieOutputPath}</span>`;
                    html += `</div>`;
                }
                
                if (tvOutputPath) {
                    html += `<div style="margin-bottom: 10px;">`;
                    html += `<strong>ğŸ“º ç”µè§†å‰§è¾“å‡ºè·¯å¾„ï¼š</strong><br>`;
                    html += `<span style="margin-left: 20px; color: #666;">${tvOutputPath}</span>`;
                    html += `</div>`;
                }
            } else {
                html += `<div style="padding: 10px; background: #ffebee; border-radius: 6px; border-left: 4px solid #f44336;">`;
                html += `<strong style="color: #d32f2f;">âŒ æœªé…ç½®è¾“å‡ºè·¯å¾„</strong><br>`;
                html += `<span style="margin-left: 20px; font-size: 12px; color: #d32f2f;">è¯·é…ç½®åª’ä½“åº“è·¯å¾„æˆ–ç”µå½±/ç”µè§†å‰§è¾“å‡ºè·¯å¾„</span>`;
                html += `</div>`;
            }
            
            // æ˜¾ç¤ºå†²çªç­–ç•¥
            html += `<div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px;">`;
            html += `<strong>âš™ï¸ å†²çªå¤„ç†ç­–ç•¥ï¼š</strong> `;
            const strategyNames = {
                'auto': 'ğŸ¤– è‡ªåŠ¨æ¯”è¾ƒ',
                'skip': 'â­ï¸ è·³è¿‡',
                'replace': 'ğŸ”„ æ›¿æ¢',
                'keep_both': 'ğŸ“¦ ä¿ç•™ä¸¤ä¸ª'
            };
            html += `${strategyNames[conflictStrategy] || conflictStrategy}`;
            html += `</div>`;
            
            previewContent.innerHTML = html;
            previewSection.style.display = 'block';
            
            // æ»šåŠ¨åˆ°é¢„è§ˆåŒºåŸŸ
            previewSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // åŠ è½½å½“å‰ç‰ˆæœ¬
        async function loadCurrentVersion() {
            try {
                const response = await fetch('/api/get-version', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                if (data.success) {
                    const versionEl = document.getElementById('currentVersion');
                    if (versionEl) {
                        versionEl.textContent = `${data.current_version} (${data.git_commit})`;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½ç‰ˆæœ¬å¤±è´¥:', error);
            }
        }
        
        // æ£€æŸ¥æ›´æ–°ï¼ˆåœ¨è®¾ç½®ä¸­ï¼‰
        async function checkForUpdates() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'ğŸ” æ£€æŸ¥ä¸­...';
            
            try {
                const useProxy = document.getElementById('updateProxyEnabled').checked;
                
                const response = await fetch('/api/check-update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ use_proxy: useProxy })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    if (data.has_update) {
                        const msg = `å‘ç°æ–°ç‰ˆæœ¬ï¼\n\nå½“å‰ç‰ˆæœ¬: ${data.current_version}\nè½åæäº¤: ${data.commits_behind} ä¸ª\n\næ˜¯å¦ç«‹å³æ›´æ–°ï¼Ÿ`;
                        if (confirm(msg)) {
                            executeUpdate();
                        }
                    } else {
                        alert('âœ… å·²æ˜¯æœ€æ–°ç‰ˆæœ¬\n\nå½“å‰ç‰ˆæœ¬: ' + data.current_version);
                    }
                } else {
                    throw new Error(data.error || 'æ£€æŸ¥æ›´æ–°å¤±è´¥');
                }
            } catch (error) {
                alert('âŒ æ£€æŸ¥æ›´æ–°å¤±è´¥\n\n' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ” æ£€æŸ¥æ›´æ–°';
            }
        }
        
        // æ‰§è¡Œæ›´æ–°
        async function executeUpdate() {
            const useProxy = document.getElementById('updateProxyEnabled').checked;
            const autoRestart = document.getElementById('autoRestartAfterUpdate').checked;
            
            // å…³é—­è®¾ç½®å¼¹çª—
            closeSettingsModal();
            
            showStatus('æ­£åœ¨æ›´æ–°ç³»ç»Ÿ...', 'info');
            
            try {
                const response = await fetch('/api/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        use_proxy: useProxy,
                        auto_restart: autoRestart
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    if (data.updated) {
                        showStatus('âœ… ' + data.message, 'success');
                        if (autoRestart) {
                            alert('âœ… æ›´æ–°æˆåŠŸï¼\n\n' + data.message + '\n\né¡µé¢å°†åœ¨5ç§’åè‡ªåŠ¨åˆ·æ–°...');
                            setTimeout(() => {
                                window.location.reload();
                            }, 5000);
                        } else {
                            alert('âœ… æ›´æ–°æˆåŠŸï¼\n\n' + data.message);
                        }
                    } else {
                        showStatus(data.message, 'info');
                        alert('â„¹ï¸ ' + data.message);
                    }
                } else {
                    throw new Error(data.error || 'æ›´æ–°å¤±è´¥');
                }
            } catch (error) {
                showStatus('æ›´æ–°å¤±è´¥: ' + error.message, 'error');
                
                // æ™ºèƒ½æç¤ºï¼šå¦‚æœæ˜¯æœ¬åœ°ä¿®æ”¹å†²çªï¼Œæä¾›å¼ºåˆ¶æ›´æ–°é€‰é¡¹
                const errorMsg = error.message.toLowerCase();
                if (errorMsg.includes('æœ¬åœ°ä¿®æ”¹') || errorMsg.includes('conflict') || errorMsg.includes('uncommitted')) {
                    if (confirm('âŒ æ›´æ–°å¤±è´¥\n\n' + error.message + '\n\næ£€æµ‹åˆ°æœ¬åœ°æ–‡ä»¶å†²çªã€‚æ˜¯å¦ä½¿ç”¨å¼ºåˆ¶æ›´æ–°ï¼Ÿ\n\nâš ï¸ å¼ºåˆ¶æ›´æ–°ä¼šè¦†ç›–æ‰€æœ‰æœ¬åœ°ä¿®æ”¹ï¼')) {
                        await forceUpdate(useProxy, autoRestart);
                    }
                } else {
                    alert('âŒ æ›´æ–°å¤±è´¥\n\n' + error.message + '\n\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åœ¨è®¾ç½®ä¸­é…ç½®ä»£ç†ã€‚');
                }
            }
        }
        
        // ç³»ç»Ÿæ›´æ–°åŠŸèƒ½ï¼ˆå¿«æ·æŒ‰é’®ï¼‰
        async function checkUpdate() {
            if (!confirm('ç¡®å®šè¦æ£€æŸ¥å¹¶æ›´æ–°ç³»ç»Ÿå—ï¼Ÿ\n\næ›´æ–°è¿‡ç¨‹ä¸­æœåŠ¡ä¼šçŸ­æš‚ä¸­æ–­ã€‚')) {
                return;
            }
            
            showStatus('æ­£åœ¨æ£€æŸ¥æ›´æ–°...', 'info');
            
            try {
                // å…ˆæ£€æŸ¥æ›´æ–°
                const checkResponse = await fetch('/api/check-update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ use_proxy: false })
                });
                
                const checkData = await checkResponse.json();
                
                if (checkData.success) {
                    if (checkData.has_update) {
                        const msg = `å‘ç°æ–°ç‰ˆæœ¬ï¼\n\nå½“å‰ç‰ˆæœ¬: ${checkData.current_version}\nè½åæäº¤: ${checkData.commits_behind} ä¸ª\n\næ­£åœ¨æ›´æ–°...`;
                        showStatus(msg, 'info');
                        
                        // æ‰§è¡Œæ›´æ–°
                        const updateResponse = await fetch('/api/update', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                use_proxy: false,
                                auto_restart: true
                            })
                        });
                        
                        const updateData = await updateResponse.json();
                        
                        if (updateResponse.ok && updateData.updated) {
                            showStatus('âœ… ' + updateData.message, 'success');
                            alert('âœ… æ›´æ–°æˆåŠŸï¼\n\n' + updateData.message + '\n\né¡µé¢å°†åœ¨5ç§’åè‡ªåŠ¨åˆ·æ–°...');
                            setTimeout(() => {
                                window.location.reload();
                            }, 5000);
                        } else {
                            throw new Error(updateData.error || 'æ›´æ–°å¤±è´¥');
                        }
                    } else {
                        showStatus('âœ… å·²æ˜¯æœ€æ–°ç‰ˆæœ¬', 'success');
                        alert('âœ… å·²æ˜¯æœ€æ–°ç‰ˆæœ¬\n\nå½“å‰ç‰ˆæœ¬: ' + checkData.current_version);
                    }
                } else {
                    throw new Error(checkData.error || 'æ£€æŸ¥æ›´æ–°å¤±è´¥');
                }
            } catch (error) {
                showStatus('æ›´æ–°å¤±è´¥: ' + error.message, 'error');
                
                // æ™ºèƒ½æç¤ºï¼šå¦‚æœæ˜¯æœ¬åœ°ä¿®æ”¹å†²çªï¼Œæä¾›å¼ºåˆ¶æ›´æ–°é€‰é¡¹
                const errorMsg = error.message.toLowerCase();
                if (errorMsg.includes('æœ¬åœ°ä¿®æ”¹') || errorMsg.includes('conflict') || errorMsg.includes('uncommitted')) {
                    if (confirm('âŒ æ›´æ–°å¤±è´¥\n\n' + error.message + '\n\næ£€æµ‹åˆ°æœ¬åœ°æ–‡ä»¶å†²çªã€‚æ˜¯å¦ä½¿ç”¨å¼ºåˆ¶æ›´æ–°ï¼Ÿ\n\nâš ï¸ å¼ºåˆ¶æ›´æ–°ä¼šè¦†ç›–æ‰€æœ‰æœ¬åœ°ä¿®æ”¹ï¼')) {
                        await forceUpdate(false, true);
                    }
                } else {
                    alert('âŒ æ›´æ–°å¤±è´¥\n\n' + error.message + '\n\nè¯·åœ¨è®¾ç½®ä¸­é…ç½®ä»£ç†åé‡è¯•ã€‚');
                }
            }
        }
        
        // å¼ºåˆ¶æ›´æ–°å‡½æ•°
        async function forceUpdate(useProxy = false, autoRestart = true) {
            showStatus('æ­£åœ¨æ‰§è¡Œå¼ºåˆ¶æ›´æ–°...', 'info');
            
            try {
                const response = await fetch('/api/force-update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        use_proxy: useProxy,
                        auto_restart: autoRestart
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    if (data.updated) {
                        showStatus('âœ… ' + data.message, 'success');
                        alert('âœ… å¼ºåˆ¶æ›´æ–°æˆåŠŸï¼\n\n' + data.message + '\n\né¡µé¢å°†åœ¨5ç§’åè‡ªåŠ¨åˆ·æ–°...');
                        setTimeout(() => {
                            window.location.reload();
                        }, 5000);
                    } else {
                        showStatus(data.message, 'info');
                        alert('â„¹ï¸ ' + data.message);
                    }
                } else {
                    throw new Error(data.error || 'å¼ºåˆ¶æ›´æ–°å¤±è´¥');
                }
            } catch (error) {
                showStatus('å¼ºåˆ¶æ›´æ–°å¤±è´¥: ' + error.message, 'error');
                alert('âŒ å¼ºåˆ¶æ›´æ–°å¤±è´¥\n\n' + error.message + '\n\nè¯·è”ç³»ç®¡ç†å‘˜æˆ–æ‰‹åŠ¨æ›´æ–°ã€‚');
            }
        }
    </script>
</body>
</html>
